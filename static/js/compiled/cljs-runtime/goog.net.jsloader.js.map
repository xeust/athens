{
"version":3,
"file":"goog.net.jsloader.js",
"lineCount":142,
"mappings":"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",
"sources":["goog/net/jsloader.js"],
"sourcesContent":["// Copyright 2011 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview A utility to load JavaScript files via DOM script tags.\n * Refactored from goog.net.Jsonp. Works cross-domain.\n *\n */\n\ngoog.provide('goog.net.jsloader');\ngoog.provide('goog.net.jsloader.Error');\ngoog.provide('goog.net.jsloader.ErrorCode');\ngoog.provide('goog.net.jsloader.Options');\n\ngoog.require('goog.array');\ngoog.require('goog.async.Deferred');\ngoog.require('goog.debug.Error');\ngoog.require('goog.dom');\ngoog.require('goog.dom.TagName');\ngoog.require('goog.dom.safe');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.object');\n\n\n/**\n * The name of the property of goog.global under which the JavaScript\n * verification object is stored by the loaded script.\n * @private {string}\n */\ngoog.net.jsloader.GLOBAL_VERIFY_OBJS_ = 'closure_verification';\n\n\n/**\n * The default length of time, in milliseconds, we are prepared to wait for a\n * load request to complete.\n * @type {number}\n */\ngoog.net.jsloader.DEFAULT_TIMEOUT = 5000;\n\n\n/**\n * Optional parameters for goog.net.jsloader.send.\n * timeout: The length of time, in milliseconds, we are prepared to wait\n *     for a load request to complete, or 0 or negative for no timeout. Default\n *     is 5 seconds.\n * document: The HTML document under which to load the JavaScript. Default is\n *     the current document.\n * cleanupWhenDone: If true clean up the script tag after script completes to\n *     load. This is important if you just want to read data from the JavaScript\n *     and then throw it away. Default is false.\n * attributes: Additional attributes to set on the script tag.\n *\n * @typedef {{\n *   timeout: (number|undefined),\n *   document: (HTMLDocument|undefined),\n *   cleanupWhenDone: (boolean|undefined),\n *   attributes: (!Object<string, string>|undefined)\n * }}\n */\ngoog.net.jsloader.Options;\n\n\n/**\n * Scripts (URIs) waiting to be loaded.\n * @private {!Array<!goog.html.TrustedResourceUrl>}\n */\ngoog.net.jsloader.scriptsToLoad_ = [];\n\n\n/**\n * The deferred result of loading the URIs in scriptsToLoad_.\n * We need to return this to a caller that wants to load URIs while\n * a deferred is already working on them.\n * @private {!goog.async.Deferred<null>}\n */\ngoog.net.jsloader.scriptLoadingDeferred_;\n\n\n\n/**\n * Loads and evaluates the JavaScript files at the specified URIs, guaranteeing\n * the order of script loads.\n *\n * Because we have to load the scripts in serial (load script 1, exec script 1,\n * load script 2, exec script 2, and so on), this will be slower than doing\n * the network fetches in parallel.\n *\n * If you need to load a large number of scripts but dependency order doesn't\n * matter, you should just call goog.net.jsloader.safeLoad N times.\n *\n * If you need to load a large number of scripts on the same domain,\n * you may want to use goog.module.ModuleLoader.\n *\n * @param {Array<!goog.html.TrustedResourceUrl>} trustedUris The URIs to load.\n * @param {goog.net.jsloader.Options=} opt_options Optional parameters. See\n *     goog.net.jsloader.options documentation for details.\n * @return {!goog.async.Deferred} The deferred result, that may be used to add\n *     callbacks\n */\ngoog.net.jsloader.safeLoadMany = function(trustedUris, opt_options) {\n  // Loading the scripts in serial introduces asynchronosity into the flow.\n  // Therefore, there are race conditions where client A can kick off the load\n  // sequence for client B, even though client A's scripts haven't all been\n  // loaded yet.\n  //\n  // To work around this issue, all module loads share a queue.\n  if (!trustedUris.length) {\n    return goog.async.Deferred.succeed(null);\n  }\n\n  var isAnotherModuleLoading = goog.net.jsloader.scriptsToLoad_.length;\n  goog.array.extend(goog.net.jsloader.scriptsToLoad_, trustedUris);\n  if (isAnotherModuleLoading) {\n    // jsloader is still loading some other scripts.\n    // In order to prevent the race condition noted above, we just add\n    // these URIs to the end of the scripts' queue and return the deferred\n    // result of the ongoing script load, so the caller knows when they\n    // finish loading.\n    return goog.net.jsloader.scriptLoadingDeferred_;\n  }\n\n  trustedUris = goog.net.jsloader.scriptsToLoad_;\n  var popAndLoadNextScript = function() {\n    var trustedUri = trustedUris.shift();\n    var deferred = goog.net.jsloader.safeLoad(trustedUri, opt_options);\n    if (trustedUris.length) {\n      deferred.addBoth(popAndLoadNextScript);\n    }\n    return deferred;\n  };\n  goog.net.jsloader.scriptLoadingDeferred_ = popAndLoadNextScript();\n  return goog.net.jsloader.scriptLoadingDeferred_;\n};\n\n\n/**\n * Loads and evaluates a JavaScript file.\n * When the script loads, a user callback is called.\n * It is the client's responsibility to verify that the script ran successfully.\n *\n * @param {!goog.html.TrustedResourceUrl} trustedUri The URI of the JavaScript.\n * @param {goog.net.jsloader.Options=} opt_options Optional parameters. See\n *     goog.net.jsloader.Options documentation for details.\n * @return {!goog.async.Deferred} The deferred result, that may be used to add\n *     callbacks and/or cancel the transmission.\n *     The error callback will be called with a single goog.net.jsloader.Error\n *     parameter.\n */\ngoog.net.jsloader.safeLoad = function(trustedUri, opt_options) {\n  var options = opt_options || {};\n  var doc = options.document || document;\n  var uri = goog.html.TrustedResourceUrl.unwrap(trustedUri);\n\n  var script = goog.dom.createElement(goog.dom.TagName.SCRIPT);\n  var request = {script_: script, timeout_: undefined};\n  var deferred = new goog.async.Deferred(goog.net.jsloader.cancel_, request);\n\n  // Set a timeout.\n  var timeout = null;\n  var timeoutDuration = (options.timeout != null) ?\n      options.timeout :\n      goog.net.jsloader.DEFAULT_TIMEOUT;\n  if (timeoutDuration > 0) {\n    timeout = window.setTimeout(function() {\n      goog.net.jsloader.cleanup_(script, true);\n      deferred.errback(\n          new goog.net.jsloader.Error(\n              goog.net.jsloader.ErrorCode.TIMEOUT,\n              'Timeout reached for loading script ' + uri));\n    }, timeoutDuration);\n    request.timeout_ = timeout;\n  }\n\n  // Hang the user callback to be called when the script completes to load.\n  // NOTE(user): This callback will be called in IE even upon error. In any\n  // case it is the client's responsibility to verify that the script ran\n  // successfully.\n  script.onload = script.onreadystatechange = function() {\n    if (!script.readyState || script.readyState == 'loaded' ||\n        script.readyState == 'complete') {\n      var removeScriptNode = options.cleanupWhenDone || false;\n      goog.net.jsloader.cleanup_(script, removeScriptNode, timeout);\n      deferred.callback(null);\n    }\n  };\n\n  // Add an error callback.\n  // NOTE(user): Not supported in IE.\n  script.onerror = function() {\n    goog.net.jsloader.cleanup_(script, true, timeout);\n    deferred.errback(\n        new goog.net.jsloader.Error(\n            goog.net.jsloader.ErrorCode.LOAD_ERROR,\n            'Error while loading script ' + uri));\n  };\n\n  var properties = options.attributes || {};\n  goog.object.extend(\n      properties, {'type': 'text/javascript', 'charset': 'UTF-8'});\n  goog.dom.setProperties(script, properties);\n  // NOTE(user): Safari never loads the script if we don't set the src\n  // attribute before appending.\n  goog.dom.safe.setScriptSrc(script, trustedUri);\n  var scriptParent = goog.net.jsloader.getScriptParentElement_(doc);\n  scriptParent.appendChild(script);\n\n  return deferred;\n};\n\n\n/**\n * Loads a JavaScript file and verifies it was evaluated successfully, using a\n * verification object.\n * The verification object is set by the loaded JavaScript at the end of the\n * script.\n * We verify this object was set and return its value in the success callback.\n * If the object is not defined we trigger an error callback.\n *\n * @param {!goog.html.TrustedResourceUrl} trustedUri The URI of the JavaScript.\n * @param {string} verificationObjName The name of the verification object that\n *     the loaded script should set.\n * @param {goog.net.jsloader.Options} options Optional parameters. See\n *     goog.net.jsloader.Options documentation for details.\n * @return {!goog.async.Deferred} The deferred result, that may be used to add\n *     callbacks and/or cancel the transmission.\n *     The success callback will be called with a single parameter containing\n *     the value of the verification object.\n *     The error callback will be called with a single goog.net.jsloader.Error\n *     parameter.\n */\ngoog.net.jsloader.safeLoadAndVerify = function(\n    trustedUri, verificationObjName, options) {\n  // Define the global objects variable.\n  if (!goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_]) {\n    goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_] = {};\n  }\n  var verifyObjs = goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_];\n  var uri = goog.html.TrustedResourceUrl.unwrap(trustedUri);\n\n  // Verify that the expected object does not exist yet.\n  if (verifyObjs[verificationObjName] !== undefined) {\n    // TODO(user): Error or reset variable?\n    return goog.async.Deferred.fail(\n        new goog.net.jsloader.Error(\n            goog.net.jsloader.ErrorCode.VERIFY_OBJECT_ALREADY_EXISTS,\n            'Verification object ' + verificationObjName +\n                ' already defined.'));\n  }\n\n  // Send request to load the JavaScript.\n  var sendDeferred = goog.net.jsloader.safeLoad(trustedUri, options);\n\n  // Create a deferred object wrapping the send result.\n  var deferred =\n      new goog.async.Deferred(goog.bind(sendDeferred.cancel, sendDeferred));\n\n  // Call user back with object that was set by the script.\n  sendDeferred.addCallback(function() {\n    var result = verifyObjs[verificationObjName];\n    if (result !== undefined) {\n      deferred.callback(result);\n      delete verifyObjs[verificationObjName];\n    } else {\n      // Error: script was not loaded properly.\n      deferred.errback(\n          new goog.net.jsloader.Error(\n              goog.net.jsloader.ErrorCode.VERIFY_ERROR, 'Script ' + uri +\n                  ' loaded, but verification object ' + verificationObjName +\n                  ' was not defined.'));\n    }\n  });\n\n  // Pass error to new deferred object.\n  sendDeferred.addErrback(function(error) {\n    if (verifyObjs[verificationObjName] !== undefined) {\n      delete verifyObjs[verificationObjName];\n    }\n    deferred.errback(error);\n  });\n\n  return deferred;\n};\n\n\n/**\n * Gets the DOM element under which we should add new script elements.\n * How? Take the first head element, and if not found take doc.documentElement,\n * which always exists.\n *\n * @param {!HTMLDocument} doc The relevant document.\n * @return {!Element} The script parent element.\n * @private\n */\ngoog.net.jsloader.getScriptParentElement_ = function(doc) {\n  var headElements = goog.dom.getElementsByTagName(goog.dom.TagName.HEAD, doc);\n  if (!headElements || goog.array.isEmpty(headElements)) {\n    return doc.documentElement;\n  } else {\n    return headElements[0];\n  }\n};\n\n\n/**\n * Cancels a given request.\n * @this {{script_: Element, timeout_: number}} The request context.\n * @private\n */\ngoog.net.jsloader.cancel_ = function() {\n  var request = this;\n  if (request && request.script_) {\n    var scriptNode = request.script_;\n    if (scriptNode && scriptNode.tagName == goog.dom.TagName.SCRIPT) {\n      goog.net.jsloader.cleanup_(scriptNode, true, request.timeout_);\n    }\n  }\n};\n\n\n/**\n * Removes the script node and the timeout.\n * @param {Node} scriptNode The node to be cleaned up.\n * @param {boolean} removeScriptNode If true completely remove the script node.\n * @param {?number=} opt_timeout The timeout handler to cleanup.\n * @private\n * @suppress {strictMissingProperties} Part of the go/strict_warnings_migration\n */\ngoog.net.jsloader.cleanup_ = function(\n    scriptNode, removeScriptNode, opt_timeout) {\n  if (opt_timeout != null) {\n    goog.global.clearTimeout(opt_timeout);\n  }\n\n  scriptNode.onload = goog.nullFunction;\n  scriptNode.onerror = goog.nullFunction;\n  scriptNode.onreadystatechange = goog.nullFunction;\n\n  // Do this after a delay (removing the script node of a running script can\n  // confuse older IEs).\n  if (removeScriptNode) {\n    window.setTimeout(function() { goog.dom.removeNode(scriptNode); }, 0);\n  }\n};\n\n\n/**\n * Possible error codes for jsloader.\n * @enum {number}\n */\ngoog.net.jsloader.ErrorCode = {\n  LOAD_ERROR: 0,\n  TIMEOUT: 1,\n  VERIFY_ERROR: 2,\n  VERIFY_OBJECT_ALREADY_EXISTS: 3\n};\n\n\n\n/**\n * A jsloader error.\n *\n * @param {goog.net.jsloader.ErrorCode} code The error code.\n * @param {string=} opt_message Additional message.\n * @constructor\n * @extends {goog.debug.Error}\n * @final\n */\ngoog.net.jsloader.Error = function(code, opt_message) {\n  var msg = 'Jsloader error (code #' + code + ')';\n  if (opt_message) {\n    msg += ': ' + opt_message;\n  }\n  goog.net.jsloader.Error.base(this, 'constructor', msg);\n\n  /**\n   * The code for this error.\n   *\n   * @type {goog.net.jsloader.ErrorCode}\n   */\n  this.code = code;\n};\ngoog.inherits(goog.net.jsloader.Error, goog.debug.Error);\n"],
"names":["goog","provide","require","net","jsloader","GLOBAL_VERIFY_OBJS_","DEFAULT_TIMEOUT","Options","scriptsToLoad_","scriptLoadingDeferred_","safeLoadMany","goog.net.jsloader.safeLoadMany","trustedUris","opt_options","length","async","Deferred","succeed","isAnotherModuleLoading","array","extend","popAndLoadNextScript","trustedUri","shift","deferred","safeLoad","addBoth","goog.net.jsloader.safeLoad","options","doc","document","uri","html","TrustedResourceUrl","unwrap","script","dom","createElement","TagName","SCRIPT","request","script_","timeout_","undefined","cancel_","timeout","timeoutDuration","window","setTimeout","cleanup_","errback","Error","ErrorCode","TIMEOUT","onload","onreadystatechange","script.onreadystatechange","readyState","removeScriptNode","cleanupWhenDone","callback","onerror","script.onerror","LOAD_ERROR","properties","attributes","object","setProperties","safe","setScriptSrc","scriptParent","getScriptParentElement_","appendChild","safeLoadAndVerify","goog.net.jsloader.safeLoadAndVerify","verificationObjName","global","verifyObjs","fail","VERIFY_OBJECT_ALREADY_EXISTS","sendDeferred","bind","cancel","addCallback","result","VERIFY_ERROR","addErrback","error","goog.net.jsloader.getScriptParentElement_","headElements","getElementsByTagName","HEAD","isEmpty","documentElement","goog.net.jsloader.cancel_","scriptNode","tagName","goog.net.jsloader.cleanup_","opt_timeout","clearTimeout","nullFunction","removeNode","goog.net.jsloader.Error","code","opt_message","msg","base","inherits","debug"]
}
