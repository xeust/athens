{
"version":3,
"file":"module$node_modules$$sentry$integrations$dist$offline.js",
"lineCount":7,
"mappings":"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",
"sources":["node_modules/@sentry/integrations/dist/offline.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$sentry$integrations$dist$offline\"] = function(global,require,module,exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar utils_1 = require(\"@sentry/utils\");\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nvar localForage = require('localforage');\n/**\n * cache offline errors and send when connected\n */\nvar Offline = /** @class */ (function () {\n    /**\n     * @inheritDoc\n     */\n    function Offline(options) {\n        if (options === void 0) { options = {}; }\n        /**\n         * @inheritDoc\n         */\n        this.name = Offline.id;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        this.global = utils_1.getGlobalObject();\n        this.maxStoredEvents = options.maxStoredEvents || 30; // set a reasonable default\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        this.offlineEventStore = localForage.createInstance({\n            name: 'sentry/offlineEventStore',\n        });\n    }\n    /**\n     * @inheritDoc\n     */\n    Offline.prototype.setupOnce = function (addGlobalEventProcessor, getCurrentHub) {\n        var _this = this;\n        this.hub = getCurrentHub();\n        if ('addEventListener' in this.global) {\n            this.global.addEventListener('online', function () {\n                _this._sendEvents().catch(function () {\n                    utils_1.logger.warn('could not send cached events');\n                });\n            });\n        }\n        addGlobalEventProcessor(function (event) {\n            if (_this.hub && _this.hub.getIntegration(Offline)) {\n                // cache if we are positively offline\n                if ('navigator' in _this.global && 'onLine' in _this.global.navigator && !_this.global.navigator.onLine) {\n                    _this._cacheEvent(event)\n                        .then(function (_event) { return _this._enforceMaxEvents(); })\n                        .catch(function (_error) {\n                        utils_1.logger.warn('could not cache event while offline');\n                    });\n                    // return null on success or failure, because being offline will still result in an error\n                    return null;\n                }\n            }\n            return event;\n        });\n        // if online now, send any events stored in a previous offline session\n        if ('navigator' in this.global && 'onLine' in this.global.navigator && this.global.navigator.onLine) {\n            this._sendEvents().catch(function () {\n                utils_1.logger.warn('could not send cached events');\n            });\n        }\n    };\n    /**\n     * cache an event to send later\n     * @param event an event\n     */\n    Offline.prototype._cacheEvent = function (event) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                return [2 /*return*/, this.offlineEventStore.setItem(utils_1.uuid4(), event)];\n            });\n        });\n    };\n    /**\n     * purge excess events if necessary\n     */\n    Offline.prototype._enforceMaxEvents = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var events;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                events = [];\n                return [2 /*return*/, this.offlineEventStore\n                        .iterate(function (event, cacheKey, _index) {\n                        // aggregate events\n                        events.push({ cacheKey: cacheKey, event: event });\n                    })\n                        .then(function () {\n                        // this promise resolves when the iteration is finished\n                        return _this._purgeEvents(\n                        // purge all events past maxStoredEvents in reverse chronological order\n                        events\n                            .sort(function (a, b) { return (b.event.timestamp || 0) - (a.event.timestamp || 0); })\n                            .slice(_this.maxStoredEvents < events.length ? _this.maxStoredEvents : events.length)\n                            .map(function (event) { return event.cacheKey; }));\n                    })\n                        .catch(function (_error) {\n                        utils_1.logger.warn('could not enforce max events');\n                    })];\n            });\n        });\n    };\n    /**\n     * purge event from cache\n     */\n    Offline.prototype._purgeEvent = function (cacheKey) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                return [2 /*return*/, this.offlineEventStore.removeItem(cacheKey)];\n            });\n        });\n    };\n    /**\n     * purge events from cache\n     */\n    Offline.prototype._purgeEvents = function (cacheKeys) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                // trail with .then to ensure the return type as void and not void|void[]\n                return [2 /*return*/, Promise.all(cacheKeys.map(function (cacheKey) { return _this._purgeEvent(cacheKey); })).then()];\n            });\n        });\n    };\n    /**\n     * send all events\n     */\n    Offline.prototype._sendEvents = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                return [2 /*return*/, this.offlineEventStore.iterate(function (event, cacheKey, _index) {\n                        if (_this.hub) {\n                            _this.hub.captureEvent(event);\n                            _this._purgeEvent(cacheKey).catch(function (_error) {\n                                utils_1.logger.warn('could not purge event from cache');\n                            });\n                        }\n                        else {\n                            utils_1.logger.warn('no hub found - could not send cached event');\n                        }\n                    })];\n            });\n        });\n    };\n    /**\n     * @inheritDoc\n     */\n    Offline.id = 'Offline';\n    return Offline;\n}());\nexports.Offline = Offline;\n//# sourceMappingURL=offline.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","Object","defineProperty","value","tslib_1","utils_1","localForage","Offline","options","name","id","getGlobalObject","maxStoredEvents","offlineEventStore","createInstance","prototype","setupOnce","Offline.prototype.setupOnce","addGlobalEventProcessor","getCurrentHub","_this","hub","addEventListener","_sendEvents","catch","logger","warn","event","getIntegration","navigator","onLine","_cacheEvent","then","_event","_enforceMaxEvents","_error","Offline.prototype._cacheEvent","__awaiter","__generator","_a","setItem","uuid4","Offline.prototype._enforceMaxEvents","events","iterate","cacheKey","_index","push","_purgeEvents","sort","a","b","timestamp","slice","length","map","_purgeEvent","Offline.prototype._purgeEvent","removeItem","Offline.prototype._purgeEvents","cacheKeys","Promise","all","Offline.prototype._sendEvents","captureEvent"]
}
