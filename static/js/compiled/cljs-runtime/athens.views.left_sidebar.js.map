{"version":3,"sources":["athens/views/left_sidebar.cljs"],"mappings":"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","names":["athens.views.left-sidebar/left-sidebar-style","athens.views.left-sidebar/left-sidebar-content-style","athens.views.left-sidebar/shortcuts-list-style","athens.style/OPACITIES","athens.views.left-sidebar/shortcut-style","athens.style.color","athens.views.left-sidebar/notional-logotype-style","athens.views.left-sidebar/version-style","p__98013","vec__98014","cljs.core.nth","athens.views.left-sidebar/shortcut-component","_","drag","reagent.core.atom","p__98017","vec__98018","order","title","uid","stylefy.core.use_style","cljs.core.merge","G__98021","cljs.core/deref","cljs.core/Keyword","e","athens.router.navigate_uid","offset","athens.util.mouse_offset","middle-y","athens.util/vertical-center","closest-li","next-sibling","last-child?","cljs.core/reset!","source-order","js/parseInt","cljs.core.prn","cljs.core._EQ_","re-frame.core/dispatch","athens.views.left-sidebar/left-sidebar","open?","re_frame.core.subscribe","shortcuts","posh.reagent/q","athens.db/dsdb","cljs.core/seq","cljs.core.sort_by","cljs.core/first","stylefy.core.use_sub_style","cljs.core.doall","iter__4529__auto__","s__98041","cljs.core/LazySeq","temp__5735__auto__","cljs.core/chunked-seq?","c__4527__auto__","size__4528__auto__","cljs.core/count","b__98043","cljs.core/chunk-buffer","i__98042","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__98040","cljs.core/chunk-rest","cljs.core/cons","cljs.core/rest","sh","cljs.core/second","athens.util/athens-version","cljs.core/chunk-first"],"sourcesContent":["(ns athens.views.left-sidebar\n  (:require\n    [athens.db :as db]\n    [athens.router :refer [navigate-uid]]\n    [athens.style :refer [color OPACITIES]]\n    [athens.util :refer [mouse-offset vertical-center]]\n    ;;[athens.views.buttons :refer [button]]\n    [cljsjs.react]\n    [cljsjs.react.dom]\n    [posh.reagent :refer [q]]\n    [re-frame.core :refer [dispatch subscribe]]\n    [reagent.core :as r]\n    [stylefy.core :as stylefy :refer [use-style use-sub-style]]))\n\n\n;;; Styles\n\n\n(def left-sidebar-style\n  {:width 0\n   :grid-area \"left-sidebar\"\n   :height \"100%\"\n   :display \"flex\"\n   :flex-direction \"column\"\n   :overflow-x \"hidden\"\n   :overflow-y \"auto\"\n   :transition \"width 0.5s ease\"\n   ::stylefy/sub-styles {:top-line {:margin-bottom \"2.5rem\"\n                                    :display \"flex\"\n                                    :flex \"0 0 auto\"\n                                    :justify-content \"space-between\"}\n                         :footer {:flex \"0 0 auto\"\n                                  :margin \"auto 2rem 0\"\n                                  :align-self \"stretch\"\n                                  :display \"grid\"\n                                  :grid-auto-flow \"column\"\n                                  :grid-template-columns \"1fr auto auto\"\n                                  :grid-gap \"0.25rem\"}\n                         :small-icon {:font-size \"16px\"}\n                         :large-icon {:font-size \"22px\"}}\n   ::stylefy/manual [[:&.is-open {:width \"18rem\"}]\n                     [:&.is-closed {:width \"0\"}]]})\n\n\n(def left-sidebar-content-style\n  {:width \"18rem\"\n   :height \"100%\"\n   :display \"flex\"\n   :flex-direction \"column\"\n   :padding \"7.5rem 0 1rem\"\n   :transition \"opacity 0.5s ease\"\n   :opacity 0\n   ::stylefy/manual [[:&.is-open {:opacity 1}]\n                     [:&.is-closed {:opacity 0}]]})\n\n\n(def shortcuts-list-style\n  {:flex \"1 1 100%\"\n   :display \"flex\"\n   :list-style \"none\"\n   :flex-direction \"column\"\n   :padding \"0 2rem\"\n   :margin \"0 0 2rem\"\n   :overflow-y \"auto\"\n   ::stylefy/sub-styles {:heading {:flex \"0 0 auto\"\n                                   :opacity (:opacity-med OPACITIES)\n                                   :line-height \"1\"\n                                   :margin \"0 0 0.25rem\"\n                                   :font-size \"inherit\"}}})\n\n\n(def shortcut-style\n  {:color (color :link-color)\n   :cursor \"pointer\"\n   :display \"flex\"\n   :flex \"0 0 auto\"\n   :padding \"0.25rem 0\"\n   :transition \"all 0.05s ease\"\n   ::stylefy/mode [[:hover {:opacity (:opacity-high OPACITIES)}]]})\n\n\n(def notional-logotype-style\n  {:font-family \"IBM Plex Serif\"\n   :font-size \"18px\"\n   :opacity (:opacity-med OPACITIES)\n   :letter-spacing \"-0.05em\"\n   :font-weight \"bold\"\n   :text-decoration \"none\"\n   :justify-self \"flex-start\"\n   :color (color :header-text-color)\n   :transition \"all 0.05s ease\"\n   ::stylefy/mode [[:hover {:opacity (:opacity-high OPACITIES)}]]})\n\n\n(def version-style\n  {:color \"inherit\"\n   :text-decoration \"none\"\n   :opacity 0.3\n   ::stylefy/mode [[:hover {:opacity (:opacity-high OPACITIES)}]]})\n\n\n;;; Components\n\n\n(defn shortcut-component\n  [[_ _ _]]\n  (let [drag (r/atom nil)]\n    (fn [[order title uid]]\n      [:li\n       [:a (use-style (merge shortcut-style\n                             (case @drag\n                               :above {:border-top [[\"1px\" \"solid\" (color :link-color)]]}\n                               :below {:border-bottom [[\"1px\" \"solid\" (color :link-color)]]}\n                               {}))\n                      {:on-click      (fn [e] (navigate-uid uid e))\n                       :draggable     true\n                       :on-drag-over  (fn [e]\n                                        (.. e preventDefault)\n                                        (let [offset       (mouse-offset e)\n                                              middle-y     (vertical-center (.. e -target))\n                                     ;; find closest li because sometimes event.target is anchor tag\n                                     ;; if nextSibling is null, then target is last li and therefore end of list\n                                              closest-li   (.. e -target (closest \"li\"))\n                                              next-sibling (.. closest-li -nextElementSibling)\n                                              last-child?  (nil? next-sibling)]\n                                          (cond\n                                            (> middle-y (:y offset)) (reset! drag :above)\n                                            (and (< middle-y (:y offset)) last-child?) (reset! drag :below))))\n                       :on-drag-start (fn [e]\n                                        (set! (.. e -dataTransfer -dropEffect) \"move\")\n                                        (.. e -dataTransfer (setData \"text/plain\" order)))\n                       :on-drag-end   (fn [_])\n                       :on-drag-leave (fn [_] (reset! drag nil))\n                       :on-drop       (fn [e]\n                                        (let [source-order (js/parseInt (.. e -dataTransfer (getData \"text/plain\")))]\n                                          (prn source-order order)\n                                          (cond\n                                            (= source-order order) nil\n                                            (and (= source-order (dec order)) (= @drag :above)) nil\n                                            (= @drag :below) (dispatch [:left-sidebar/drop-below source-order order])\n                                            :else (dispatch [:left-sidebar/drop-above source-order order])))\n                                        (reset! drag nil))})\n        title]])))\n\n\n(defn left-sidebar\n  []\n  (let [open? (subscribe [:left-sidebar/open])\n        shortcuts (->> @(q '[:find ?order ?title ?uid\n                             :where\n                             [?e :page/sidebar ?order]\n                             [?e :node/title ?title]\n                             [?e :block/uid ?uid]] db/dsdb)\n                       seq\n                       (sort-by first))]\n    ;; (when @open?\n\n      ;; IF EXPANDED\n    [:div (use-style left-sidebar-style {:class (if @open? \"is-open\" \"is-closed\")})\n     [:div (use-style left-sidebar-content-style {:class (if @open? \"is-open\" \"is-closed\")})\n\n       ;; SHORTCUTS\n      [:ol (use-style shortcuts-list-style)\n       [:h2 (use-sub-style shortcuts-list-style :heading) \"Shortcuts\"]\n       (doall\n         (for [sh shortcuts]\n           ^{:key (str \"left-sidebar-\" (second sh))}\n           [shortcut-component sh]))]\n\n       ;; LOGO + BOTTOM BUTTONS\n      [:footer (use-sub-style left-sidebar-style :footer)\n       [:a (use-style notional-logotype-style {:href \"https://github.com/athensresearch/athens\" :target \"_blank\"}) \"Athens\"]\n       [:h5 (use-style {:align-self \"center\"})\n        [:a (use-style version-style {:href \"https://github.com/athensresearch/athens/blob/master/CHANGELOG.md\"\n                                      :target \"_blank\"})\n         (athens.util/athens-version)]]]]]))\n\n"]}