{"version":3,"sources":["athens/views/all_pages.cljs"],"mappings":";AAmBA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKA;AAOL,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKC,AAMsC,AAAA,AAACC,AAkBA,AAAA,AAAeC,AAKlB,AAAA,AAAkB,AAAA,AAACD,AAEnC,AAAAE,AAAa,AAACE,AAAAA,AAAAA;AAAd,AAAA,AAAAF,AAAAA,AAACC,AAAAA,AAAAA;AA/B1B,AAAA,AAAA,AAAA,AAAA,AAAA,AAiCyB,AAAAE,AAAa,AAACC,AAAAA,AAAAA;AAAd,AAAA,AAAAD,AAAAA,AAACF,AAAAA,AAAAA;AAjC1B,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAmCoD,AAAA,AAAA,AAACH,AAEvB,AAAAO,AAAa,AAACH,AAAAA,AAAAA;AAAd,AAAA,AAAAG,AAAAA,AAACJ,AAAAA,AAAAA;AArC/B,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAqC8F,AAAA,AAAA,AAACH,AACjE,AAAAQ,AAAa,AAACF,AAAAA,AAAAA;AAAd,AAAA,AAAAE,AAAAA,AAACL,AAAAA,AAAAA;AAtC/B,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAsC4F,AAAA,AAAA,AAACH,AAEpD,AAAA,AAAcC;AAMvD,AAAA,AAAMQ;AAAN,AAEE,AAAMC,AAAM,AAACC,AAAO,AAMK,AAACO,AAAQ,AAAKC,AACdE;AADS,AAAQ,AAACD,AAAM,AAAA,AAAcD;AANtC,AAAAP,AAAA,AAAA,AAIA,AAAA,AAAA,AAACK,AAAYD,AACbF,AACA;AANAD,AAAA,AAAAC,AAGME;AAHN,AAAA,AAAAJ,AAAAC,AAAAD,AAAAC,AAACE,AAAAA,AAAAA;;AAA1B,AAQE;AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AACQ,AAACO,AAAUxB,AACR,AAACwB,AAAUvB,AAMX,AAAA,AAACwB,AAAcxB,AACf,AAAA,AAACwB,AAAcxB,AAErB,AAACyB,AACC,AAAAC,AAAA,AAAAC;AAAA,AAAA,AAAAC,AAAA,AAAA;AAAA,AAAA,AAAAD,AAAAA;;AAAA,AAAA,AAAAE,AAAA,AAAAC,AAAAH;AAAA,AAAA,AAAAE;AAAA,AAAA,AAAAF,AAAAE;AAAA,AAAA,AAAA,AAAAE,AAAAJ;AAAA,AAAAK,AAu2EwC,AAAAiC,AAAAtC;AAv2ExCM,AAAA,AAAAZ,AAAAW;AAAAE,AAAA,AAAAC,AAAAF;AAAA,AAAA,AAAA,AAAA,AAAAG,AAAA;;AAAA,AAAA,AAAA,AAAAA,AAAAH;AAAA,AAAA,AAAAI,AAAAL,AAAAI,AAAMU;AAAN,AAAA,AAAA,AAAAR,AAAAJ,AACE,AAAAa,AAAyGD;AAAzGC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAA,AAAAI,AAAAJ,AAAA,AAA+DU;AAA/D,AAAAN,AAAAJ,AAAA,AAAmFW;AAAnF,AAAAP,AAAAJ,AAAA,AAAcM;AAAd,AAAAF,AAAAJ,AAAA,AAAwBO;AAAxB,AAAAH,AAAAJ,AAAA,AAAmCQ;AAAnC,AAAAJ,AAAAJ,AAAA,AAAkDS;AAAlD,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AACaH,AACL,AAAA,AAAA,AAAA,AAAA,AAAC7B,AAAcxB;AAAf2D;AAAA,AAAiD,AAAAA,AAACC,AAAaP;;AAFvE,AAAA,AAAA,AAAA,AAAA,AAAA,AAEgFC,AACxE,AAAA,AAAC9B,AAAcxB,AAAuB,AAACqB,AAAMmC,AACvC,AAAA,AAAChC,AAAcxB,AAA2B,AAAA,AAAC6D,AAAc,AAAA,AAACE;AAADD;AAAA,AAAM,AAAA,AAAU,AAAA,AAAAA;;AAJvF,AAAA,AAAA,AAAA,AAI0GP,AAClG,AAAA,AAAC/B,AAAcxB,AAAsB,AAACgE,AAAYP,AAClD,AAAA,AAACjC,AAAcxB,AAAsB,AAACgE,AAAYN;;;AAP5D,AAAA,AAAAtB,AAAA;;;;AAAA;;;;;AAAA,AAAAG,AAAA,AAAAC,AAAAN,AAAA,AAAAO,AAAA,AAAAC,AAAAf;;AAAA,AAAAY,AAAA,AAAAC,AAAAN,AAAA;;;AAAA,AAAA,AAAAS,AAAAhB,AAAMmB;AAAN,AAAA,AAAAF,AACE,AAAAQ,AAAyGN;AAAzGM,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAJ,AAAA,AAAAI,AAAA,AAAA,AAAA,AAAA,AAAAH,AAAAC,AAAAE,AAAAA;AAAA,AAAAD,AAAAC,AAAA,AAA+DK;AAA/D,AAAAN,AAAAC,AAAA,AAAmFM;AAAnF,AAAAP,AAAAC,AAAA,AAAcC;AAAd,AAAAF,AAAAC,AAAA,AAAwBE;AAAxB,AAAAH,AAAAC,AAAA,AAAmCG;AAAnC,AAAAJ,AAAAC,AAAA,AAAkDI;AAAlD,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AACaH,AACL,AAAA,AAAA,AAAA,AAAA,AAAC7B,AAAcxB;AAAf2D;AAAA,AAAiD,AAAAA,AAACC,AAAaP;;AAFvE,AAAA,AAAA,AAAA,AAAA,AAAA,AAEgFC,AACxE,AAAA,AAAC9B,AAAcxB,AAAuB,AAACqB,AAAMmC,AACvC,AAAA,AAAChC,AAAcxB,AAA2B,AAAA,AAAC6D,AAAc,AAAA,AAACE;AAADD;AAAA,AAAM,AAAA,AAAU,AAAA,AAAAA;;AAJvF,AAAA,AAAA,AAAA,AAI0GP,AAClG,AAAA,AAAC/B,AAAcxB,AAAsB,AAACgE,AAAYP,AAClD,AAAA,AAACjC,AAAcxB,AAAsB,AAACgE,AAAYN;AAP5D,AAAAjB,AAAA,AAAAI,AAAAlB;;;AAAA;;;;AAAA,AAAA;;AAAA,AAAA,AAAAD,AAAA,AAAAX,AAAYJ","names":["athens.views.all-pages/page-style","athens.views.all-pages/table-style","athens.style.color","athens.style/OPACITIES","G__96105","garden.selectors/&","garden.selectors/first-child","G__96106","garden.selectors/last-child","G__96107","G__96108","athens.views.all-pages/table","pages","reagent.core.atom","G__96122","G__96123","cljs.core/deref","datascript.core/q","athens.db/dsdb","posh.reagent/pull-many","cljs.core.sort_by","x","cljs.core/count","cljs.core/reverse","stylefy.core.use_style","stylefy.core.use_sub_style","cljs.core.doall","iter__4529__auto__","s__96130","cljs.core/LazySeq","temp__5735__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4527__auto__","size__4528__auto__","b__96132","cljs.core/chunk-buffer","i__96131","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__96129","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","page","map__96135","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","map__96140","uid","title","children","_refs","modified","created","p1__96113#","athens.router.navigate_uid","clojure.string.join","p1__96118#","cljs.core.map","athens.util/date-string","cljs.core/chunk-first"],"sourcesContent":["(ns athens.views.all-pages\n  (:require\n    [athens.db :as db]\n    [athens.router :refer [navigate-uid]]\n    [athens.style :as style :refer [color OPACITIES]]\n    [athens.util :refer [date-string]]\n    [cljsjs.react]\n    [cljsjs.react.dom]\n    [clojure.string :as str]\n    [datascript.core :as d]\n    [garden.selectors :as selectors]\n    [posh.reagent :as p]\n    [reagent.core :as r]\n    [stylefy.core :as stylefy :refer [use-style use-sub-style]]))\n\n\n;;; Styles\n\n\n(def page-style\n  {:display \"flex\"\n   :margin \"5rem auto\"\n   :flex-basis \"100%\"\n   :max-width \"70rem\"})\n\n\n(def table-style\n  {:flex \"1 1 100%\"\n   :margin \"0 2rem\"\n   :text-align \"left\"\n   :border-collapse \"collapse\"\n   ::stylefy/sub-styles {:th-date {:text-align \"right\"}\n                         :td-title {:color (color :link-color)\n                                    :width \"15vw\"\n                                    :cursor \"pointer\"\n                                    :min-width \"10em\"\n                                    :word-break \"break-word\"\n                                    :font-weight \"500\"\n                                    :font-size \"1.3125em\"\n                                    :line-height \"1.28\"}\n                         :td-links {:font-size \"1em\"\n                                    :text-align \"center\"}\n                         :body-preview {:white-space \"wrap\"\n                                        :word-break \"break-word\"\n                                        :overflow \"hidden\"\n                                        :text-overflow \"ellipsis\"\n                                        :display \"-webkit-box\"\n                                        :-webkit-line-clamp \"3\"\n                                        :-webkit-box-orient \"vertical\"}\n                         :td-date {:text-align \"right\"\n                                   :opacity (:opacity-high OPACITIES)\n                                   :font-size \"0.75em\"\n                                   :min-width \"9em\"}}\n   ::stylefy/manual [[:tbody {:vertical-align \"top\"}\n                      [:tr {:transition \"background 0.1s ease\"}\n                       [:td {:border-top (str \"1px solid \" (color :border-color))\n                             :transition \"box-shadow 0.1s ease\"}\n                        [(selectors/& (selectors/first-child)) {:border-radius \"0.5rem 0 0 0.5rem\"\n                                                                :box-shadow \"-1rem 0 transparent\"}]\n                        [(selectors/& (selectors/last-child)) {:border-radius \"0 0.5rem 0.5rem 0\"\n                                                               :box-shadow \"1rem 0 transparent\"}]]\n                       [:&:hover {:background-color (color :background-minus-1 :opacity-med)\n                                  :border-radius \"0.5rem\"}\n                        [:td [(selectors/& (selectors/first-child)) {:box-shadow [[\"-1rem 0 \" (color :background-minus-1 :opacity-med)]]}]]\n                        [:td [(selectors/& (selectors/last-child)) {:box-shadow [[\"1rem 0 \" (color :background-minus-1 :opacity-med)]]}]]]]]\n                     [:td :th {:padding \"0.5rem\"}]\n                     [:th [:h5 {:opacity (:opacity-med OPACITIES)}]]]})\n\n\n;;; Components\n\n\n(defn table\n  []\n  (let [pages (r/atom (->> (d/q '[:find [?e ...]\n                                  :where\n                                  [?e :node/title ?t]]\n                                @db/dsdb)\n                           (p/pull-many db/dsdb '[\"*\" :block/_refs {:block/children [:block/string] :limit 5}])\n                           deref\n                           (sort-by (fn [x] (count (:block/_refs x))))\n                           reverse))]\n    (fn []\n      [:div (use-style page-style)\n       [:table (use-style table-style)\n        [:thead\n         [:tr\n          [:th [:h5 \"Title\"]]\n          [:th [:h5 \"Links\"]]\n          [:th [:h5 \"Body\"]]\n          [:th (use-sub-style table-style :th-date) [:h5 \"Modified\"]]\n          [:th (use-sub-style table-style :th-date) [:h5 \"Created\"]]]]\n        [:tbody\n         (doall\n           (for [page @pages]\n             (let [{:keys [block/uid node/title block/children block/_refs] modified :edit/time created :create/time} page]\n               [:tr {:key uid}\n                [:td (use-sub-style table-style :td-title {:on-click #(navigate-uid uid %)}) title]\n                [:td (use-sub-style table-style :td-links) (count _refs)]\n                [:td [:div (use-sub-style table-style :body-preview) (str/join \" \") (map #(str \"\u2022 \" (:block/string %)) children)]]\n                [:td (use-sub-style table-style :td-date) (date-string modified)]\n                [:td (use-sub-style table-style :td-date) (date-string created)]])))]]])))\n"]}