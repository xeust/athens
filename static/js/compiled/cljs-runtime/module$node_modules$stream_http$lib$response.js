shadow$provide.module$node_modules$stream_http$lib$response=function(global,require,module,exports){var process=require("module$node_modules$process$browser"),Buffer=require("module$node_modules$buffer$index").Buffer,capability=require("module$node_modules$stream_http$lib$capability");module=require("module$node_modules$inherits$inherits_browser");var stream=require("module$node_modules$readable_stream$readable_browser"),rStates=exports.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,
DONE:4};require=exports.IncomingMessage=function(xhr,response,mode,fetchTimer){var self=this;stream.Readable.call(self);self._mode=mode;self.headers={};self.rawHeaders=[];self.trailers={};self.rawTrailers=[];self.on("end",function(){process.nextTick(function(){self.emit("close")})});if("fetch"===mode){var read=function(){reader.read().then(function(result){self._destroyed||(result.done?(global.clearTimeout(fetchTimer),self.push(null)):(self.push(new Buffer(result.value)),read()))}).catch(function(err){global.clearTimeout(fetchTimer);
self._destroyed||self.emit("error",err)})};self._fetchResponse=response;self.url=response.url;self.statusCode=response.status;self.statusMessage=response.statusText;response.headers.forEach(function(header,key){self.headers[key.toLowerCase()]=header;self.rawHeaders.push(key,header)});if(capability.writableStream){xhr=new WritableStream({write:function(chunk){return new Promise(function(resolve,reject){self._destroyed?reject():self.push(new Buffer(chunk))?resolve():self._resumeFetch=resolve})},close:function(){global.clearTimeout(fetchTimer);
self._destroyed||self.push(null)},abort:function(err){self._destroyed||self.emit("error",err)}});try{response.body.pipeTo(xhr).catch(function(err){global.clearTimeout(fetchTimer);self._destroyed||self.emit("error",err)});return}catch(e){}}var reader=response.body.getReader();read()}else if(self._xhr=xhr,self._pos=0,self.url=xhr.responseURL,self.statusCode=xhr.status,self.statusMessage=xhr.statusText,xhr.getAllResponseHeaders().split(/\r?\n/).forEach(function(header){if(header=header.match(/^([^:]+):\s*(.*)/)){var key=
header[1].toLowerCase();"set-cookie"===key?(void 0===self.headers[key]&&(self.headers[key]=[]),self.headers[key].push(header[2])):self.headers[key]=void 0!==self.headers[key]?self.headers[key]+(", "+header[2]):header[2];self.rawHeaders.push(header[1],header[2])}}),self._charset="x-user-defined",!capability.overrideMimeType){if(response=self.rawHeaders["mime-type"])if(response=response.match(/;\s*charset=([^;])(;|$)/))self._charset=response[1].toLowerCase();self._charset||(self._charset="utf-8")}};
module(require,stream.Readable);require.prototype._read=function(){var resolve=this._resumeFetch;resolve&&(this._resumeFetch=null,resolve())};require.prototype._onXHRProgress=function(){var self=this,xhr=self._xhr,response=null;switch(self._mode){case "text:vbarray":if(xhr.readyState!==rStates.DONE)break;try{response=(new global.VBArray(xhr.responseBody)).toArray()}catch(e){}if(null!==response){self.push(new Buffer(response));break}case "text":try{response=xhr.responseText}catch(e){self._mode="text:vbarray";
break}if(response.length>self._pos){xhr=response.substr(self._pos);if("x-user-defined"===self._charset){for(var buffer=new Buffer(xhr.length),i=0;i<xhr.length;i++)buffer[i]=xhr.charCodeAt(i)&255;self.push(buffer)}else self.push(xhr,self._charset);self._pos=response.length}break;case "arraybuffer":if(xhr.readyState!==rStates.DONE||!xhr.response)break;response=xhr.response;self.push(new Buffer(new Uint8Array(response)));break;case "moz-chunked-arraybuffer":response=xhr.response;if(xhr.readyState!==
rStates.LOADING||!response)break;self.push(new Buffer(new Uint8Array(response)));break;case "ms-stream":if(response=xhr.response,xhr.readyState===rStates.LOADING){var reader=new global.MSStreamReader;reader.onprogress=function(){reader.result.byteLength>self._pos&&(self.push(new Buffer(new Uint8Array(reader.result.slice(self._pos)))),self._pos=reader.result.byteLength)};reader.onload=function(){self.push(null)};reader.readAsArrayBuffer(response)}}self._xhr.readyState===rStates.DONE&&"ms-stream"!==
self._mode&&self.push(null)}}
//# sourceMappingURL=module$node_modules$stream_http$lib$response.js.map
