shadow$provide.module$node_modules$$sentry$core$dist$baseclient=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("module$node_modules$tslib$tslib"),hub_1=require("module$node_modules$$sentry$hub$dist$index"),types_1=require("module$node_modules$$sentry$types$dist$index"),utils_1=require("module$node_modules$$sentry$utils$dist$index"),integration_1=require("module$node_modules$$sentry$core$dist$integration");global=function(){function BaseClient(backendClass,
options){this._integrations={};this._processing=0;this._backend=new backendClass(options);this._options=options;options.dsn&&(this._dsn=new utils_1.Dsn(options.dsn))}BaseClient.prototype.captureException=function(exception,hint,scope){var _this=this,eventId=hint&&hint.event_id;this._process(this._getBackend().eventFromException(exception,hint).then(function(event){return _this._captureEvent(event,hint,scope)}).then(function(result){eventId=result}));return eventId};BaseClient.prototype.captureMessage=
function(message,level,hint,scope){var _this=this,eventId=hint&&hint.event_id;message=utils_1.isPrimitive(message)?this._getBackend().eventFromMessage(""+message,level,hint):this._getBackend().eventFromException(message,hint);this._process(message.then(function(event){return _this._captureEvent(event,hint,scope)}).then(function(result){eventId=result}));return eventId};BaseClient.prototype.captureEvent=function(event,hint,scope){var eventId=hint&&hint.event_id;this._process(this._captureEvent(event,
hint,scope).then(function(result){eventId=result}));return eventId};BaseClient.prototype.captureSession=function(session){session.release?this._sendSession(session):utils_1.logger.warn("Discarded session because of missing release")};BaseClient.prototype.getDsn=function(){return this._dsn};BaseClient.prototype.getOptions=function(){return this._options};BaseClient.prototype.flush=function(timeout){var _this=this;return this._isClientProcessing(timeout).then(function(ready){return _this._getBackend().getTransport().close(timeout).then(function(transportFlushed){return ready&&
transportFlushed})})};BaseClient.prototype.close=function(timeout){var _this=this;return this.flush(timeout).then(function(result){_this.getOptions().enabled=!1;return result})};BaseClient.prototype.setupIntegrations=function(){this._isEnabled()&&(this._integrations=integration_1.setupIntegrations(this._options))};BaseClient.prototype.getIntegration=function(integration){try{return this._integrations[integration.id]||null}catch(_oO){return utils_1.logger.warn("Cannot retrieve integration "+integration.id+
" from the current Client"),null}};BaseClient.prototype._updateSessionFromEvent=function(session,event){var _a,crashed=!1,errored=!1,exceptions=event.exception&&event.exception.values;if(exceptions){errored=!0;try{for(var exceptions_1=tslib_1.__values(exceptions),exceptions_1_1=exceptions_1.next();!exceptions_1_1.done;exceptions_1_1=exceptions_1.next()){var mechanism=exceptions_1_1.value.mechanism;if(mechanism&&!1===mechanism.handled){crashed=!0;break}}}catch(e_1_1){var e_1={error:e_1_1}}finally{try{exceptions_1_1&&
!exceptions_1_1.done&&(_a=exceptions_1.return)&&_a.call(exceptions_1)}finally{if(e_1)throw e_1.error;}}}e_1=event.user;if(!session.userAgent){event=event.request?event.request.headers:{};for(var key in event)if("user-agent"===key.toLowerCase()){var userAgent=event[key];break}}session.update(tslib_1.__assign(tslib_1.__assign({},crashed&&{status:types_1.SessionStatus.Crashed}),{user:e_1,userAgent,errors:session.errors+Number(errored||crashed)}))};BaseClient.prototype._sendSession=function(session){this._getBackend().sendSession(session)};
BaseClient.prototype._isClientProcessing=function(timeout){var _this=this;return new utils_1.SyncPromise(function(resolve){var ticked=0,interval=setInterval(function(){0==_this._processing?(clearInterval(interval),resolve(!0)):(ticked+=1,timeout&&ticked>=timeout&&(clearInterval(interval),resolve(!1)))},1)})};BaseClient.prototype._getBackend=function(){return this._backend};BaseClient.prototype._isEnabled=function(){return!1!==this.getOptions().enabled&&void 0!==this._dsn};BaseClient.prototype._prepareEvent=
function(event,scope,hint){var _this=this,_a=this.getOptions().normalizeDepth,normalizeDepth=void 0===_a?3:_a;event=tslib_1.__assign(tslib_1.__assign({},event),{event_id:event.event_id||(hint&&hint.event_id?hint.event_id:utils_1.uuid4()),timestamp:event.timestamp||utils_1.dateTimestampInSeconds()});this._applyClientOptions(event);this._applyIntegrationsMetadata(event);hint&&hint.captureContext&&(scope=hub_1.Scope.clone(scope).update(hint.captureContext));_a=utils_1.SyncPromise.resolve(event);scope&&
(_a=scope.applyToEvent(event,hint));return _a.then(function(evt){return"number"===typeof normalizeDepth&&0<normalizeDepth?_this._normalizeEvent(evt,normalizeDepth):evt})};BaseClient.prototype._normalizeEvent=function(event,depth){if(!event)return null;var normalized=tslib_1.__assign(tslib_1.__assign(tslib_1.__assign(tslib_1.__assign(tslib_1.__assign({},event),event.breadcrumbs&&{breadcrumbs:event.breadcrumbs.map(function(b){return tslib_1.__assign(tslib_1.__assign({},b),b.data&&{data:utils_1.normalize(b.data,
depth)})})}),event.user&&{user:utils_1.normalize(event.user,depth)}),event.contexts&&{contexts:utils_1.normalize(event.contexts,depth)}),event.extra&&{extra:utils_1.normalize(event.extra,depth)});event.contexts&&event.contexts.trace&&(normalized.contexts.trace=event.contexts.trace);return normalized};BaseClient.prototype._applyClientOptions=function(event){var options=this.getOptions(),environment=options.environment,release=options.release,dist=options.dist,_a=options.maxValueLength;_a=void 0===
_a?250:_a;"environment"in event||(event.environment="environment"in options?environment:"production");void 0===event.release&&void 0!==release&&(event.release=release);void 0===event.dist&&void 0!==dist&&(event.dist=dist);event.message&&(event.message=utils_1.truncate(event.message,_a));(options=event.exception&&event.exception.values&&event.exception.values[0])&&options.value&&(options.value=utils_1.truncate(options.value,_a));(event=event.request)&&event.url&&(event.url=utils_1.truncate(event.url,
_a))};BaseClient.prototype._applyIntegrationsMetadata=function(event){event=event.sdk;var integrationsArray=Object.keys(this._integrations);event&&0<integrationsArray.length&&(event.integrations=integrationsArray)};BaseClient.prototype._sendEvent=function(event){this._getBackend().sendEvent(event)};BaseClient.prototype._captureEvent=function(event,hint,scope){return this._processEvent(event,hint,scope).then(function(finalEvent){return finalEvent.event_id},function(reason){utils_1.logger.error(reason)})};
BaseClient.prototype._processEvent=function(event$jscomp$0,hint,scope){var _this=this,_a=this.getOptions(),beforeSend=_a.beforeSend;_a=_a.sampleRate;if(!this._isEnabled())return utils_1.SyncPromise.reject(new utils_1.SentryError("SDK not enabled, will not send event."));var isTransaction="transaction"===event$jscomp$0.type;return!isTransaction&&"number"===typeof _a&&Math.random()>_a?utils_1.SyncPromise.reject(new utils_1.SentryError("This event has been sampled, will not send event.")):this._prepareEvent(event$jscomp$0,
scope,hint).then(function(prepared){if(null===prepared)throw new utils_1.SentryError("An event processor returned null, will not send event.");if(hint&&hint.data&&!0===hint.data.__sentry__||isTransaction||!beforeSend)return prepared;prepared=beforeSend(prepared,hint);if("undefined"===typeof prepared)throw new utils_1.SentryError("`beforeSend` method has to return `null` or a valid event.");return utils_1.isThenable(prepared)?prepared.then(function(event){return event},function(e){throw new utils_1.SentryError("beforeSend rejected with "+
e);}):prepared}).then(function(processedEvent){if(null===processedEvent)throw new utils_1.SentryError("`beforeSend` returned `null`, will not send event.");var session=scope&&scope.getSession();!isTransaction&&session&&_this._updateSessionFromEvent(session,processedEvent);_this._sendEvent(processedEvent);return processedEvent}).then(null,function(reason){if(reason instanceof utils_1.SentryError)throw reason;_this.captureException(reason,{data:{__sentry__:!0},originalException:reason});throw new utils_1.SentryError("Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: "+
reason);})};BaseClient.prototype._process=function(promise){var _this=this;this._processing+=1;promise.then(function(value){--_this._processing;return value},function(reason){--_this._processing;return reason})};return BaseClient}();exports.BaseClient=global}
//# sourceMappingURL=module$node_modules$$sentry$core$dist$baseclient.js.map
