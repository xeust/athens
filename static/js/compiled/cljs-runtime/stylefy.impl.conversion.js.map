{"version":3,"sources":["stylefy/impl/conversion.cljc"],"mappings":";AAQA;;;AAAA,AAAMA,AAEHC;AAFH,AAGE,AAACC,AACC,AAAKC,AAAOC;AAAZ,AACE,AAAMC,AAAM,AAACD,AAAAA,AAAAA,AAASH,AAAAA;AAAtB,AACE,AAAI,AAACK,AAAuBD;AAC1B,AAACE,AAAMJ,AAAOC,AAAS,AAACI,AAAoBH;;AAC5CF;;AACNF,AACA,AAACQ,AAAKR;;AAEV,AAAA,AAAOS,AAAmCT;AAA1C,AACE,AAAAU,AAAmB,AAAA,AAAuBV;AAA1C,AAAA,AAAAU;AAAA,AAAA,AAAAA,AAAWC;AAAX,AAAA,AAAA,AAAA,AACYA,AACI,AAAA,AAA2BX;;AAF3C;;;AAIF,AAAA,AAAOY,AAAiCZ;AAAxC,AACE,AAAMa,AAAM,AAAA,AAAoBb;AAC1Bc,AAAY,AAAKC,AAAUC;AAAf,AACE,AAAQ,AAAI,AAAAE,AAAUH,AACV,AAAK,AAASA,AACT,AAAA,AAACI,AAAiBJ;AAFnC;AAAA,AAAA,AAAA,AAAAE,AAAA,AAAA,AAAA,AAAA,AAGQ,AAAA,AAAiF,AAACG,AAAOL;;;AACjG,AAAM,AAAK,AAASA,AACT,AAAA,AAAG,AAACM,AAAM,AAAA,AAACC,AAAUP;AADhC,AAEE,AAACQ,AAAS,AAAA,AAAsE,AAACH,AAAOL;;AAF1F;;AALF,AAQG,AAACS,AAAQ,AAAA,AAAST,AAAYC;;AATnD,AAUE,AACE,AAACS,AAAKZ;AAAO,AAAA,AAAAa,AAACC;AAAD,AAAO,AAAAD,AAACZ,AAAc,AAAAY,AAACE,AAAIf;AAAU,AAACL,AAAKK;;AAD1D,AAEE,AAACgB,AAAQhB;AAAO,AAAA,AAAAiB,AAACH;AAAD,AAAO,AAACb,AAAY,AAAAgB,AAACC,AAAS,AAAAD,AAACE;AAAWnB;;AAF5D;;;;AAIJ,AAAA,AAAMoB,AAAgBC;AAAtB,AACE,AAACV,AAAQ,AAAA,AAASU;;AAEpB;;;AAAA,AAAAC,AAAOK,AAE2CG;AAFlD,AAAA,AAAAP,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAAA,AAE2CM;AAF3C,AAAAd,AAAAQ,AAAA,AAEWpC;AAFX,AAAA4B,AAAAQ,AAAA,AAEiBF;AAFjB,AAAAN,AAAAQ,AAAA,AAEsBK;AAFtB,AAGE,AAAMG,AAAU,AAACC,AAA8B7C;AACzC8C,AAAa,AAAAC,AAAIN;AAAJ,AAAA,AAAAM;AAAAA;;AAAoB,AAACd,AAAeC;;;AADvD,AAEMc,AAAyBF,AAAaF;AACtCK,AAAsB,AAACrC,AAAgCZ;AACvDkD,AAAe,AAACzC,AAAkCT;AAClDmD,AAAe,AAAAJ,AAAI,AAACK,AAAMT,AAAQO;AAAnB,AAAA,AAAAH;AAAAA;;AAAA;;;AACfM,AAAU,AAACC,AAAIH,AAAe,AAACI,AAAKP,AACAC;AAP1C,AAQEI;;AAEJ;;;AAAA,AAAAG,AAAOE,AAE2Cf;AAFlD,AAAA,AAAAc,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAApB,AAAA,AAAAoB,AAAA,AAAA,AAAA,AAAA,AAAAnB,AAAAC,AAAAkB,AAAAA;AAAAA,AAE2Cf;AAF3C,AAAAd,AAAA6B,AAAA,AAEWzD;AAFX,AAAA4B,AAAA6B,AAAA,AAEiBvB;AAFjB,AAAAN,AAAA6B,AAAA,AAEsBhB;AAFtB,AAGE,AAAA/B,AAAiC,AAAA,AAAqBV;AAAtD,AAAA,AAAAU;AAAA,AAAA,AAAAA,AAAWiD;AAAX,AACE,AAAMb,AAAa,AAAAC,AAAIN;AAAJ,AAAA,AAAAM;AAAAA;;AAAoB,AAACd,AAAeC;;;AACjD0B,AACA,AAACC,AACC,AAAKC;AAAL,AACE,AAAMC,AAAkB,AAACnC,AAAI+B,AAAsBG;AAC7CE,AAAsB,AAACnB,AAA8BkB;AAD3D,AAEMf,AAAyBF,AAAakB;AACtCf,AAAsB,AAACrC,AAAgCmD;AACvDb,AAAe,AAACzC,AAAkCsD;AAClDZ,AAAe,AAAAJ,AAAI,AAACK,AAAMT,AAAQO;AAAnB,AAAA,AAAAH;AAAAA;;AAAA;;;AALrB,AAME,AAACO,AAAIH,AAAe,AAACc,AAASH,AAAY,AAACP,AAAKP,AACAC;AACpD,AAACzC,AAAKmD;AAZd,AAaE,AAACrB,AAAM4B,AAAIN;;AAdf;;;AAgBF;;;AAAA,AAAAO,AAAOE,AAE2C1B;AAFlD,AAAA,AAAAyB,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA/B,AAAA,AAAA+B,AAAA,AAAA,AAAA,AAAA,AAAA9B,AAAAC,AAAA6B,AAAAA;AAAAA,AAE2C1B;AAF3C,AAAAd,AAAAwC,AAAA,AAEWpE;AAFX,AAAA4B,AAAAwC,AAAA,AAEiBlC;AAFjB,AAAAN,AAAAwC,AAAA,AAEsB3B;AAFtB,AAGE,AAAA/B,AAA4B,AAAA,AAAwBV;AAApD,AAAA,AAAAU;AAAA,AAAA,AAAAA,AAAW4D;AAAX,AACE,AAAMxB,AAAa,AAAAC,AAAIN;AAAJ,AAAA,AAAAM;AAAAA;;AAAoB,AAACd,AAAeC;;;AACjDqC,AAAa,AAACV,AACC,AAAKW;AAAL,AACE,AAAMC,AAAe,AAAC7C,AAAI0C,AAAiBE;AACrCE,AAAmB,AAAC7B,AAA8B4B;AADxD,AAEMzB,AAAyBF,AAAa4B;AACtCzB,AAAsB,AAACrC,AAAgC6D;AACvDvB,AAAe,AAACzC,AAAkCgE;AAClDtB,AAAe,AAAAJ,AAAI,AAACK,AAAMT,AAAQO;AAAnB,AAAA,AAAAH;AAAAA;;AAAA;;;AACf4B,AACA,AAAA,AAAA,AAAA,AAAA,AAACjB,AACSe,AACDvC,AACWO,AAClBE;AAXR,AAYE,AAAA,AAAA,AAAA,AAAmB6B,AACd,AAAClB,AAAIH,AAAe,AAACI,AAAKP,AACAC,AAC1B0B;AAET,AAACnE,AAAK8D;AApB3B,AAqBE,AAAChC,AAAM4B,AAAIK;;AAtBf;;;AAwBF;;;AAAA,AAAAK,AAAOE,AAE2CnC;AAFlD,AAAA,AAAAkC,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAxC,AAAA,AAAAwC,AAAA,AAAA,AAAA,AAAA,AAAAvC,AAAAC,AAAAsC,AAAAA;AAAAA,AAE2CnC;AAF3C,AAAAd,AAAAiD,AAAA,AAEW7E;AAFX,AAAA4B,AAAAiD,AAAA,AAEiB3C;AAFjB,AAAAN,AAAAiD,AAAA,AAEsBpC;AAFtB,AAGE,AAAA/B,AAAiC,AAAA,AAAsBV;AAAvD,AAAA,AAAAU;AAAA,AAAA,AAAAA,AAAWqE;AAAX,AACE,AAAMC,AAAoB,AAAAjC,AAAIN;AAAJ,AAAA,AAAAM;AAAAA;;AAAoB,AAACd,AAAeC;;;AACxD+C,AAAkB,AAACpB,AACA,AAAKqB;AAAL,AACE,AAAMC,AAA8B,AAAA,AAAAC,AAACC;AAAD,AAAoB,AAAI,AAAAD,AAAC3D;AACJ,AAAA2D,AAACvC;;AADFuC;;AAGFE,AACAJ;AAChDK,AAAwB,AAAA,AAAA,AAAChC,AAAMyB,AAAsBG;AACrD9B,AAAU,AAACC,AAAIX,AAAQ4C;AAN7B,AAOElC;AACJ0B;AAXzB,AAYE,AAACzC,AAAM4B,AAAIe;;AAbf;;;AAeF,AAAA;;;AAAA,AAAAO,AAAME;AAAN,AAAA,AAAAD,AAAA,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAA,AAAAC,AAAA,AAAA,AAAA;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA;;;;AAAA,AAAA,AAAAzE,AAAA,AAAA,AAAA,AAAA;;;;;AAAA,AAAA,AAAA,AAAMyE,AAEFhD;AAFJ,AAEW,AAAA,AAACmD,AAAWnD;;;AAFvB,AAAA,AAAA,AAAAiD,AAAMD,AAG6B/C;AAHnC,AAAA,AAAAiD,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAvD,AAAA,AAAAuD,AAAA,AAAA,AAAA,AAAA,AAAAtD,AAAAC,AAAAqD,AAAAA;AAAAA,AAG4BlD;AAH5B,AAAAd,AAAAgE,AAAA,AAGY5F;AAHZ,AAAA4B,AAAAgE,AAAA,AAGkB1D;AAHlB,AAIG,AAAMmB,AAAU,AAACb,AAA8BE,AAAMC;AAC/CiB,AAAkB,AAACF,AAAsBhB,AAAMC;AAC/C4B,AAAa,AAACF,AAAuB3B,AAAMC;AAC3CsC,AAAkB,AAACH,AAAsBpC,AAAMC;AAHrD,AAIE,AAAKU,AACAO,AACAW,AACAU;;;AAXV,AAAA,AAAA,AAAMS;;AAAN","names":["stylefy.impl.conversion/garden-units->css","props","cljs.core.reduce","result","next-key","value","stylefy.impl.utils/is-garden-value?","cljs.core.assoc","garden.compiler/render-css","cljs.core/keys","stylefy.impl.conversion/convert-stylefy-vendors-to-garden","temp__5735__auto__","vendors","stylefy.impl.conversion/convert-stylefy-modes-to-garden","modes","handle-mode","mode-name","mode-props","js/Error","cljs.core/Keyword","clojure.string/starts-with?","cljs.core.pr_str","cljs.core/count","clojure.string.split","stylefy.impl.log/warn","cljs.core.keyword","cljs.core/map?","p1__94442#","cljs.core.mapv","cljs.core.get","cljs.core/vector?","p1__94443#","cljs.core/first","cljs.core/second","stylefy.impl.conversion/class-selector","hash","p__94451","map__94452","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","stylefy.impl.conversion/convert-base-style-into-class","custom-selector","style","options","css-props","stylefy.impl.utils/remove-special-keywords","css-selector","or__4126__auto__","garden-class-definition","garden-pseudo-classes","garden-vendors","garden-options","cljs.core.merge","css-class","garden.core.css","cljs.core.into","p__94458","map__94459","stylefy.impl.conversion/convert-media-queries","stylefy-media-queries","css-media-queries","cljs.core.map","media-query","media-query-props","media-query-css-props","garden.stylesheet.at_media","cljs.core/str","p__94469","map__94470","stylefy.impl.conversion/convert-supports-rules","stylefy-supports","css-supports","supports-selector","supports-props","supports-css-props","css-media-queries-inside-supports","p__94479","map__94481","stylefy.impl.conversion/convert-manual-styles","stylefy-manual-styles","css-parent-selector","css-manual-styles","manual-style","manual-selector-and-css-props","p1__94475#","clojure.walk/walk","cljs.core/identity","garden-style-definition","var_args","G__94485","stylefy.impl.conversion/style->css","p__94490","map__94491","stylefy.impl.conversion.style__GT_css"],"sourcesContent":["(ns stylefy.impl.conversion\r\n  (:require [garden.core :refer [css]]\r\n            [stylefy.impl.utils :as utils]\r\n            [garden.stylesheet :refer [at-media at-keyframes at-font-face]]\r\n            [stylefy.impl.log :as log]\r\n            [clojure.string :as str]\r\n            [garden.compiler :as compiler]))\r\n\r\n(defn garden-units->css\r\n  \"Checks all values in the map and converts all Garden units to CSS.\"\r\n  [props]\r\n  (reduce\r\n    (fn [result next-key]\r\n      (let [value (next-key props)]\r\n        (if (utils/is-garden-value? value)\r\n          (assoc result next-key (compiler/render-css value))\r\n          result)))\r\n    props\r\n    (keys props)))\r\n\r\n(defn- convert-stylefy-vendors-to-garden [props]\r\n  (when-let [vendors (:stylefy.core/vendors props)]\r\n    {:vendors vendors\r\n     :auto-prefix (:stylefy.core/auto-prefix props)}))\r\n\r\n(defn- convert-stylefy-modes-to-garden [props]\r\n  (let [modes (:stylefy.core/mode props)\r\n        handle-mode (fn [mode-name mode-props]\r\n                      (assert (or (keyword? mode-name)\r\n                                  (and (string? mode-name)\r\n                                       (str/starts-with? mode-name \":\")))\r\n                              (str \"Mode must be specified as a keyword or string beginning with colon, got: \" (pr-str mode-name)))\r\n                      (when (and (string? mode-name)\r\n                                 (> (count (str/split mode-name \" \")) 1))\r\n                        (log/warn (str \"Incorrect mode detected, should not contain spaces. Mode was: \" (pr-str mode-name))))\r\n                      [(keyword (str \"&\" mode-name)) mode-props])]\r\n    (cond\r\n      (map? modes) (mapv #(handle-mode % (get modes %)) (keys modes))\r\n      (vector? modes) (mapv #(handle-mode (first %) (second %)) modes))))\r\n\r\n(defn class-selector [hash]\r\n  (keyword (str \".\" hash)))\r\n\r\n(defn- convert-base-style-into-class\r\n  \"Converts Clojure style map into CSS class.\"\r\n  [{:keys [props hash custom-selector] :as style} options]\r\n  (let [css-props (utils/remove-special-keywords props)\r\n        css-selector (or custom-selector (class-selector hash))\r\n        garden-class-definition [css-selector css-props]\r\n        garden-pseudo-classes (convert-stylefy-modes-to-garden props)\r\n        garden-vendors (convert-stylefy-vendors-to-garden props)\r\n        garden-options (or (merge options garden-vendors) {})\r\n        css-class (css garden-options (into garden-class-definition\r\n                                            garden-pseudo-classes))]\r\n    css-class))\r\n\r\n(defn- convert-media-queries\r\n  \"Converts stylefy/media definition into CSS media query.\"\r\n  [{:keys [props hash custom-selector] :as style} options]\r\n  (when-let [stylefy-media-queries (:stylefy.core/media props)]\r\n    (let [css-selector (or custom-selector (class-selector hash))\r\n          css-media-queries\r\n          (map\r\n            (fn [media-query]\r\n              (let [media-query-props (get stylefy-media-queries media-query)\r\n                    media-query-css-props (utils/remove-special-keywords media-query-props)\r\n                    garden-class-definition [css-selector media-query-css-props]\r\n                    garden-pseudo-classes (convert-stylefy-modes-to-garden media-query-props)\r\n                    garden-vendors (convert-stylefy-vendors-to-garden media-query-props)\r\n                    garden-options (or (merge options garden-vendors) {})]\r\n                (css garden-options (at-media media-query (into garden-class-definition\r\n                                                                garden-pseudo-classes)))))\r\n            (keys stylefy-media-queries))]\r\n      (apply str css-media-queries))))\r\n\r\n(defn- convert-supports-rules\r\n  \"Converts stylefy/supports definition into CSS feature query.\"\r\n  [{:keys [props hash custom-selector] :as style} options]\r\n  (when-let [stylefy-supports (:stylefy.core/supports props)]\r\n    (let [css-selector (or custom-selector (class-selector hash))\r\n          css-supports (map\r\n                         (fn [supports-selector]\r\n                           (let [supports-props (get stylefy-supports supports-selector)\r\n                                 supports-css-props (utils/remove-special-keywords supports-props)\r\n                                 garden-class-definition [css-selector supports-css-props]\r\n                                 garden-pseudo-classes (convert-stylefy-modes-to-garden supports-props)\r\n                                 garden-vendors (convert-stylefy-vendors-to-garden supports-props)\r\n                                 garden-options (or (merge options garden-vendors) {})\r\n                                 css-media-queries-inside-supports\r\n                                 (convert-media-queries\r\n                                   {:props supports-props\r\n                                    :hash hash\r\n                                    :custom-selector custom-selector}\r\n                                   options)]\r\n                             (str \"@supports (\" supports-selector \") {\"\r\n                                  (css garden-options (into garden-class-definition\r\n                                                            garden-pseudo-classes))\r\n                                  css-media-queries-inside-supports\r\n                                  \"}\")))\r\n                         (keys stylefy-supports))]\r\n      (apply str css-supports))))\r\n\r\n(defn- convert-manual-styles\r\n  \"Converts stylefy/manual definition into CSS.\"\r\n  [{:keys [props hash custom-selector] :as style} options]\r\n  (when-let [stylefy-manual-styles (:stylefy.core/manual props)]\r\n    (let [css-parent-selector (or custom-selector (class-selector hash))\r\n          css-manual-styles (map\r\n                             (fn [manual-style]\r\n                               (let [manual-selector-and-css-props (clojure.walk/walk #(if (map? %)\r\n                                                                                        (utils/remove-special-keywords %)\r\n                                                                                        %)\r\n                                                                                     identity\r\n                                                                                     manual-style)\r\n                                     garden-style-definition (into [css-parent-selector] [manual-selector-and-css-props])\r\n                                     css-class (css options garden-style-definition)]\r\n                                 css-class))\r\n                             stylefy-manual-styles)]\r\n      (apply str css-manual-styles))))\r\n\r\n(defn style->css\r\n  \"Converts the given style to CSS. Options are sent directly to Garden\"\r\n  ([style] (style->css style {}))\r\n  ([{:keys [props hash] :as style} options]\r\n   (let [css-class (convert-base-style-into-class style options)\r\n         css-media-queries (convert-media-queries style options)\r\n         css-supports (convert-supports-rules style options)\r\n         css-manual-styles (convert-manual-styles style options)]\r\n     (str css-class\r\n          css-media-queries\r\n          css-supports\r\n          css-manual-styles))))"]}