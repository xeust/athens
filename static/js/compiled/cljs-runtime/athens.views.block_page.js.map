{"version":3,"sources":["athens/views/block_page.cljs"],"mappings":"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","names":["athens.views.block-page/title-style","athens.style.color","garden.selectors/+","athens.views.block-page/transact-string","string","block","athens.util/now-ts","athens.views.block-page/persist-textarea-string","state","diff?","cljs.core.not_EQ_","re-frame.core/dispatch","athens.views.block-page/block-page-change","e","_uid","value","cljs.core.swap_BANG_","cljs.core/assoc","athens.views.block-page/breadcrumb-handle-click","uid","breadcrumb-uid","right-sidebar?","athens.router.navigate_uid","athens.views.block-page/block-page-el","_","reagent.core.atom","parents","editing-uid","refs","map__60672","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","children","cljs.core/deref","stylefy.core.use_style","athens.views.node-page/page-style","athens.views.breadcrumbs/breadcrumbs-list","cljs.core.doall","iter__4529__auto__","s__60676","cljs.core/LazySeq","temp__5735__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4527__auto__","size__4528__auto__","cljs.core/count","b__60678","cljs.core/chunk-buffer","i__60677","map__60680","cljs.core/-nth","cljs.core/chunk-append","p1__60671#","cljs.core/chunk-cons","cljs.core/chunk","iter__60675","cljs.core/chunk-rest","map__60682","cljs.core/first","cljs.core/cons","cljs.core/rest","title","athens.views.breadcrumbs/breadcrumb","or__4126__auto__","cljs.core.merge","komponentit.autosize/textarea","cljs.core._EQ_","athens.views.node-page/handle-key-down","clojure.string/blank?","athens.parse-renderer/parse-and-render","s__60700","b__60702","i__60701","iter__60699","child","map__60703","map__60705","id","athens.views.blocks/block-el","cljs.core/not-empty","athens.views.node-page/references-style","athens.views.node-page/references-heading-style","reagent.core/adapt-react-class","js/module$node_modules$$material_ui$icons$Link.default","athens.views.node-page/references-list-style","s__60708","b__60710","i__60709","vec__60712","cljs.core.nth","iter__60707","vec__60719","group-title","group","athens.views.node-page/references-group-style","athens.views.node-page/references-group-title-style","athens.parse-renderer/pull-node-from-string","s__60716","b__60718","i__60717","iter__60715","s__60723","b__60725","i__60724","iter__60722","athens.views.node-page/references-group-block-style","athens.views.node-page/ref-comp","athens.views.block-page/block-page-component","ident","athens.db/get-block-document","athens.db/get-parents-recursively","re_frame.core.subscribe","athens.db/get-linked-block-references","cljs.core/chunk-first"],"sourcesContent":["(ns athens.views.block-page\n  (:require\n    [\"@material-ui/icons/Link\" :default Link]\n    [athens.db :as db]\n    [athens.parse-renderer :as parse-renderer]\n    [athens.router :refer [navigate-uid]]\n    [athens.style :refer [color]]\n    [athens.util :refer [now-ts]]\n    [athens.views.blocks :refer [block-el]]\n    [athens.views.breadcrumbs :refer [breadcrumbs-list breadcrumb]]\n    #_[athens.views.buttons :refer [button]]\n    [athens.views.node-page :as node-page]\n    [cljsjs.react]\n    [cljsjs.react.dom]\n    [garden.selectors :as selectors]\n    [komponentit.autosize :as autosize]\n    [re-frame.core :refer [dispatch subscribe]]\n    [reagent.core :as r]\n    [stylefy.core :as stylefy :refer [use-style]]))\n\n\n;;; Styles\n\n\n(def title-style\n  {:position        \"relative\"\n   :overflow        \"visible\"\n   :flex-grow       \"1\"\n   :margin          \"0.1em 0\"\n   :letter-spacing  \"-0.03em\"\n   :word-break      \"break-word\"\n   :line-height     \"1.4em\"\n   ::stylefy/manual [[:textarea {:display \"none\"}]\n                     [:&:hover [:textarea {:display \"block\"\n                                           :z-index 1}]]\n                     [:textarea {:-webkit-appearance \"none\"\n                                 :cursor             \"text\"\n                                 :resize             \"none\"\n                                 :transform          \"translate3d(0,0,0)\"\n                                 :color              \"inherit\"\n                                 :font-weight        \"inherit\"\n                                 :padding            \"0\"\n                                 :letter-spacing     \"inherit\"\n                                 :position           \"absolute\"\n                                 :top                \"0\"\n                                 :left               \"0\"\n                                 :right              \"0\"\n                                 :width              \"100%\"\n                                 :min-height         \"100%\"\n                                 :caret-color        (color :link-color)\n                                 :background         \"transparent\"\n                                 :margin             \"0\"\n                                 :font-size          \"inherit\"\n                                 :line-height        \"inherit\"\n                                 :border-radius      \"0.25rem\"\n                                 :transition         \"opacity 0.15s ease\"\n                                 :border             \"0\"\n                                 :opacity            \"0\"\n                                 :font-family        \"inherit\"}]\n                     [:textarea:focus\n                      :.is-editing {:outline \"none\"\n                                    :z-index 3\n                                    :display \"block\"\n                                    :opacity \"1\"}]\n                     [(selectors/+ :.is-editing :span) {:opacity 0}]]})\n\n;;; Helpers\n\n(defn transact-string\n  \"A helper function that takes a `string` and a `block` and datascript `transact` vector\n  ready for `dispatch`. Used in `block-page-el` function to log when there is a diff and `on-blur`.\"\n  [string block]\n  [:transact [{:db/id        [:block/uid (:block/uid block)]\n               :block/string string\n               :edit/time    (now-ts)}]])\n\n\n(defn persist-textarea-string\n  \"A helper fn that takes `state` containing textarea changes and when user has made a text change dispatches `transact-string`. \"\n  [state block]\n  (let [diff? (not= (:string/local state)\n                    (:string/previous state))]\n    (when diff?\n      (dispatch (transact-string (:string/local state) block)))))\n\n;;; Components\n\n(defn block-page-change\n  [e _uid state]\n  (let [value (.. e -target -value)]\n    (swap! state assoc :string/local value)))\n\n\n(defn breadcrumb-handle-click\n  \"If block is in main, navigate to page. If in right sidebar, replace right sidebar item.\"\n  [e uid breadcrumb-uid]\n  (let [right-sidebar? (.. e -target (closest \".right-sidebar\"))]\n    (if right-sidebar?\n      (dispatch [:right-sidebar/navigate-item uid breadcrumb-uid])\n      (navigate-uid breadcrumb-uid e))))\n\n\n(defn block-page-el\n  [_ _ _ _]\n  (let [state (r/atom {:string/local    nil\n                       :string/previous nil})]\n    (fn [block parents editing-uid refs]\n      (let [{:block/keys [string children uid]} block]\n\n        (when (not= string (:string/previous @state))\n          (swap! state assoc :string/previous string :string/local string))\n\n        [:div.block-page (use-style node-page/page-style {:data-uid uid})\n         ;; Parent Context\n         [:span {:style {:color \"gray\"}}\n          [breadcrumbs-list {:style {:font-size \"1.2rem\"}}\n           (doall\n             (for [{:keys [node/title block/string] breadcrumb-uid :block/uid} parents]\n               ^{:key breadcrumb-uid}\n               [breadcrumb {:key (str \"breadcrumb-\" breadcrumb-uid)\n                            :on-click #(breadcrumb-handle-click % uid breadcrumb-uid)}\n                (or title string)]))]]\n\n         ;; Header\n         [:h1 (merge\n                (use-style title-style {:data-uid uid :class \"block-header\"})\n                {:on-click (fn [e]\n                             (.. e preventDefault)\n                             (if (.. e -shiftKey)\n                               (navigate-uid uid e)\n                               (dispatch [:editing/uid uid])))})\n          [autosize/textarea\n           {:id          (str \"editable-uid-\" uid)\n            :value       (:string/local @state)\n            :class       (when (= editing-uid uid) \"is-editing\")\n            :auto-focus  true\n            :on-blur     (fn [_] (persist-textarea-string @state block))\n            :on-key-down (fn [e] (node-page/handle-key-down e uid state nil))\n            :on-change   (fn [e] (block-page-change e uid state))}]\n          (if (clojure.string/blank? (:string/local @state))\n            [:wbr]\n            [:span [parse-renderer/parse-and-render (:string/local @state) uid]])]\n\n         ;; Children\n         [:div (for [child children]\n                 (let [{:keys [db/id]} child]\n                   ^{:key id} [block-el child]))]\n\n         ;; Refs\n         (when (not-empty refs)\n           [:div (use-style node-page/references-style {:key \"Linked References\"})\n            [:section\n             [:h4 (use-style node-page/references-heading-style)\n              [(r/adapt-react-class Link)]\n              [:span \"Linked References\"]]\n              ;; Hide button until feature is implemented\n              ;;[button {:disabled true} [(r/adapt-react-class FilterList)]]]\n             [:div (use-style node-page/references-list-style)\n              (doall\n                (for [[group-title group] refs]\n                  [:div (use-style node-page/references-group-style {:key (str \"group-\" group-title)})\n                   [:h4 (use-style node-page/references-group-title-style)\n                    [:a {:on-click #(navigate-uid (:block/uid @(parse-renderer/pull-node-from-string group-title)))} group-title]]\n                   (doall\n                     (for [block group]\n                       [:div (use-style node-page/references-group-block-style {:key (str \"ref-\" (:block/uid block))})\n                        [node-page/ref-comp block]]))]))]]])]))))\n\n\n(defn block-page-component\n  [ident]\n  (let [block       (db/get-block-document ident)\n        parents     (db/get-parents-recursively ident)\n        editing-uid @(subscribe [:editing/uid])\n        refs        (db/get-linked-block-references block)]\n    [block-page-el block parents editing-uid refs]))\n\n"]}