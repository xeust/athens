{"version":3,"sources":["athens/parser.cljc"],"mappings":";AAOA,AAAA,AAMA,AAAA,AAAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAD,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAD,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAD,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAD,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAD,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAD,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAD,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAWE;AA+FX;;;;AAAA,AAAMC,AAGHC;AAHH,AAIE,AAACC,AACC,AAAKC,AAAgBC;AAArB,AACE,AAAI,AAAK,AAASA,AAAM,AAAS,AAACC,AAAKF;AACrC,AAAMG,AAAkB,AAACC,AAAIJ;AACvBK,AAAqB,AAAK,AAACH,AAAKF,AAAiBC;AADvD,AAEE,AAACK,AAAKH,AAAkBE;;AAC1B,AAACC,AAAKN,AAAgBC;;AAN5B,AAQEH;;AAGJ;;;AAAA,AAAMS,AAEHC;AAFH,AAGE,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AA0B2B;AAAOa;AAAP,AACE,AAACD,AAAYC;;;AADRA;;;;AAAAA;;AAAAA;;;AAAAA;AAAAA;;;;;AAzBP,AASAH;AATOP;AAAP,AAEE,AAAA,AAAA,AAACC,AAAc,AAAChB,AAAyBe;;;AAFpCA;;;;AAAAA;;AAAAA;;;AAAAA;AAAAA;;;;;AAaPO,AAMA;AAAOC;AAAP,AACE,AAAMF,AAAI,AAACG,AAAYD;AAAvB,AAAA,AAAA,AAAA,AAAA,AACmBF,AAAKA;;;AAFnBE;;;;AAAAA;;AAAAA;;;AAAAA;AAAAA;;;;;AAhBP,AAAAN,AAAqBI;AAArB,AAAA,AAAAH,AAAAD;AAAA,AAAAE,AAAAD,AAAA,AAAA,AAAME;AAAN,AACE,AAAA,AAAA,AAAA,AAAA,AAAA,AAACJ,AAAuBK,AAASD;AAuBnC,AAAKM;AAAL,AACE,AAAA,AAAA,AAACV,AAAiBU,AAAoB,AAACC,AAAK,AAAC5B,AAAAA,AAAAA,AAAa2B,AAAAA;AAjB5DJ,AACAA,AAWA;AAAOP;AAAP,AACE,AAACf,AAAyBe;;;AADrBA;;;;AAAAA;;AAAAA;;;AAAAA;AAAAA;;;;;AAlBP,AAAKK,AAAcC,AAKnBC,AAIAA;AATA,AACE,AAAA,AAAA,AAAA,AAAA,AAACN,AAAsBK,AAAMD;AAS/BE;AAhB3BT,AA8BEF;AA9BF,AAAA,AAAAC,AAAAC,AAAAD,AAAAC,AAACC,AAAAA,AAAAA;;AAiCH;;;AAAA,AAAMc,AAEHC;AAFH,AAGE,AAACnB,AAAiB,AAACX,AAAAA,AAAAA,AAAa8B,AAAAA","names":["instaparse.core/map->Parser","instaparse.core.parser","cljs.core.merge","instaparse.combinators-source/regexp","cljs.core/List","athens.parser/block-parser","athens.parser/combine-adjacent-strings","coll","cljs.core.reduce","elements-so-far","elmt","cljs.core/peek","previous-elements","cljs.core/pop","combined-last-string","cljs.core.conj","athens.parser/transform-to-ast","tree","G__88671","G__88672","instaparse.core/transform","raw-contents","cljs.core.into","p__88681","vec__88682","cljs.core.nth","text-contents","url","cljs.core/identity","url-parts","clojure.string.join","chars","raw-content-string","cljs.core/rest","athens.parser/parse-to-ast","string"],"sourcesContent":["(ns athens.parser\n  (:require\n    [clojure.string :as string]\n    #?(:cljs [instaparse.core :as insta :refer-macros [defparser]]\n       :clj  [instaparse.core :as insta :refer [defparser]])))\n\n\n(declare block-parser)\n\n\n;; Instaparse docs: https://github.com/Engelberg/instaparse#readme\n;; Main parser documentation: `doc/parser.md` in this repository\n\n(defparser block-parser\n  \"(* Welcome to the Athens Block Parser! *)\n   (* We're currently building a more robust + performant one, so if you have any idea *)\n   (* regarding how to implement it better, feel free to open an issue and lend us a hand! :) *)\n   (* Currently, this is implemented similar to a LL(1) parser, which should keep its performance levels at O(n). *)\n\n   (* This first rule is the top-level one. *)\n   (* `/` ordered alternation is used to, for example, try to interpret a string beginning with '[[' as a page-link before interpreting it as raw characters. *)\n   block = (url-raw / non-url-plaintext / pre-formatted / syntax-in-block / reserved-char) *\n\n   (* Sequence of non-reserved chars, but not a URL. *)\n   <non-url-plaintext> = !url-raw non-reserved-chars\n\n   (* The following regular expression expresses this: (any character except '`') <- This repeated as many times as possible *)\n   <any-non-pre-formatted-chars> = #'[^\\\\`]*'\n   pre-formatted = block-pre-formatted | inline-pre-formatted\n   <block-pre-formatted> = <'```'> any-non-pre-formatted-chars <'```'>\n   <inline-pre-formatted> = <'`'> any-non-pre-formatted-chars <'`'>\n\n   (* Because code blocks are pre-formatted, we process them before these applied syntaxes. *)\n   <basic-text-formats> = (bold | italic | strikethrough | underline | highlight)\n   <syntax-in-block> = (component | page-link | block-ref | hashtag | url-image | url-link | basic-text-formats | latex)\n\n   <syntax-in-component> = (page-link | block-ref)\n   <any-non-component-reserved-chars> = #'[^\\\\{\\\\}]*'\n   component = <'{{'> any-non-component-reserved-chars <'}}'>\n\n   (* The following regular expression expresses this: (any character except '[' or ']') <- This repeated as many times as possible *)\n   <any-non-page-link-chars> = #'[^\\\\[\\\\]]*'\n   <page-link-content> = (any-non-page-link-chars | page-link)*\n   page-link = <'[['> page-link-content <']]'>\n\n   (* A block reference could only be letters, numbers, and lower and regular dash. *)\n   block-ref = <'(('> #'[a-zA-Z0-9_\\\\-]+' <'))'>\n\n   hashtag = hashtag-bare | hashtag-delimited\n   <hashtag-bare> = <'#'> #'[^\\\\ \\\\+\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\?\\\\\\\"\\\\;\\\\:\\\\]\\\\[]+'  (* Unicode: L = letters, M = combining marks, N = numbers *)\n   <hashtag-delimited> = <'#'> <'[['> page-link-content <']]'>\n\n   (* See https://en.wikipedia.org/wiki/URL#Syntax *)\n   url-scheme = #'(?i)(https?|ftp)'\n   url-userinfo = #'(?:\\\\S+(?::\\\\S*)?@)'\n   (* TODO(agentydragon): Also accepts invalid IP addresses, such as 999.999.999.999. *)\n   url-ip = #'(\\\\d{1,3}\\\\.){3}\\\\d{1,3}'\n   url-registered-name = #'(?i)(?:(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)*(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff]{2,}))\\\\.?'\n   url-host = (url-ip | url-registered-name)\n   url-port = #'\\\\d{2,5}'\n   url-path = #'[/?#]\\\\S*'\n   url-raw = url-scheme '://' (url-userinfo)? url-host (':' url-port)? url-path?\n\n   url-image = <'!'> url-link-text url-link-url\n\n   url-link = url-link-text url-link-url\n   <url-link-text> = <'['> url-link-text-contents <']'>\n   url-link-text-contents = ( (bold | backslash-escaped-right-bracket) / any-char )*\n   <backslash-escaped-right-bracket> = <'\\\\\\\\'> ']'\n   <url-link-url> = <'('> url-link-url-parts <')'>\n   url-link-url-parts = url-link-url-part+\n   <url-link-url-part> = (backslash-escaped-paren | '(' url-link-url-part* ')') / any-char\n   <backslash-escaped-paren> = <'\\\\\\\\'> ('(' | ')')\n\n   (* The following regular expression expresses this: (any character except '*') <- This repeated as many times as possible *)\n   <non-bold-chars> = #'[^\\\\*]*'\n   bold = <'**'> non-bold-chars <'**'>\n\n   <non-italic-chars> = #'[^_]*'\n   italic = <'__'> non-italic-chars <'__'>\n\n   <non-strikethrough-chars> = #'[^~]*'\n   strikethrough = <'~~'> non-strikethrough-chars <'~~'>\n\n   <non-underline-chars> = #'[^-]*'\n   underline = <'--'> non-underline-chars <'--'>\n\n   <non-highlight-chars> = #'[^\\\\^]*'\n   highlight = <'^^'> non-highlight-chars <'^^'>\n\n   (* LaTeX *)\n   <not-dollars> = #'.*?(?=\\\\$\\\\$)'\n   latex = <'$$'> not-dollars <'$$'>\n\n   (* -- It\u2019s useful to extract this rule because its transform joins the individual characters everywhere it\u2019s used. *)\n   (* -- However, I think in many cases a more specific rule can be used. So we will migrate away from uses of this rule. *)\n   \n   (* Here are a list of 'stop characters' we implemented, to get the LL(1) performance. *)\n   (* The current reserved characters are:  -> ^ ( [ * < ` {  # ! $ <- _ ~ space - *)\n   (* Note that since our grammar is a left-recursive one, we only use the opening chars in the pair. *)\n   (* IMPORTANT: if you are adding new reserved characters to the list, remember to change them all in the following regex & update the list above! *)\n   (* Regex could be a thinker at times, but you can use this tool https://regex101.com/ for a visual debugging experience. *)\n   <reserved-char> =      #'[\\\\^\\\\(\\\\[\\\\*\\\\<\\\\`\\\\{\\\\#\\\\!\\\\$_~ -]'\n   <non-reserved-chars> = #'[^\\\\^\\\\(\\\\[\\\\*\\\\<\\\\`\\\\{\\\\#\\\\!\\\\$_~ -]*'\n   <any-char> = #'\\\\w|\\\\W'\n   \")\n\n\n(defn combine-adjacent-strings\n  \"In a sequence of strings mixed with other values, returns the same sequence with adjacent strings concatenated.\n   (If the sequence contains only strings, use clojure.string/join instead.)\"\n  [coll]\n  (reduce\n    (fn [elements-so-far elmt]\n      (if (and (string? elmt) (string? (peek elements-so-far)))\n        (let [previous-elements (pop elements-so-far)\n              combined-last-string (str (peek elements-so-far) elmt)]\n          (conj previous-elements combined-last-string))\n        (conj elements-so-far elmt)))\n    []\n    coll))\n\n\n(defn transform-to-ast\n  \"Transforms the Instaparse output tree to an abstract syntax tree for Athens markup.\"\n  [tree]\n  (insta/transform\n    {:block                  (fn [& raw-contents]\n                                ;; use combine-adjacent-strings to collapse individual characters from any-char into one string\n                               (into [:block] (combine-adjacent-strings raw-contents)))\n     :url-image              (fn [[text-contents] url]\n                               (into [:url-image {:url url :alt text-contents}]))\n     :url-link               (fn [text-contents url]\n                               (into [:url-link {:url url}] text-contents))\n\n     ; Unwrap AST nodes representing parts of URLs into their string representation.\n     :url-ip                 identity\n     :url-port               identity\n     :url-scheme             identity\n     :url-registered-name    identity\n     :url-host               identity\n     :url-path               identity\n     :url-userinfo           identity\n\n     ; URL parts in url-raw get transformed into their string representation.\n     ; Concatenate them to get the actual URL.\n     :url-raw                (fn [& url-parts]\n                               (let [url (string/join url-parts)]\n                                 [:url-link {:url url} url]))\n\n     :url-link-text-contents (fn [& raw-contents]\n                               (combine-adjacent-strings raw-contents))\n     :url-link-url-parts     (fn [& chars]\n                               (string/join chars))\n     :component              (fn [raw-content-string]\n                               (into [:component raw-content-string] (rest (block-parser raw-content-string))))}\n    tree))\n\n\n(defn parse-to-ast\n  \"Converts a string of block syntax to an abstract syntax tree for Athens markup.\"\n  [string]\n  (transform-to-ast (block-parser string)))\n"]}