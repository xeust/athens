{
"version":3,
"file":"module$node_modules$stream_http$lib$request.js",
"lineCount":11,
"mappings":"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",
"sources":["node_modules/stream-http/lib/request.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$stream_http$lib$request\"] = function(global,require,module,exports) {\nvar process = require('process');\nvar Buffer = require('buffer').Buffer;\nvar capability = require('./capability')\nvar inherits = require('inherits')\nvar response = require('./response')\nvar stream = require('readable-stream')\nvar toArrayBuffer = require('to-arraybuffer')\n\nvar IncomingMessage = response.IncomingMessage\nvar rStates = response.readyStates\n\nfunction decideMode (preferBinary, useFetch) {\n\tif (capability.fetch && useFetch) {\n\t\treturn 'fetch'\n\t} else if (capability.mozchunkedarraybuffer) {\n\t\treturn 'moz-chunked-arraybuffer'\n\t} else if (capability.msstream) {\n\t\treturn 'ms-stream'\n\t} else if (capability.arraybuffer && preferBinary) {\n\t\treturn 'arraybuffer'\n\t} else if (capability.vbArray && preferBinary) {\n\t\treturn 'text:vbarray'\n\t} else {\n\t\treturn 'text'\n\t}\n}\n\nvar ClientRequest = module.exports = function (opts) {\n\tvar self = this\n\tstream.Writable.call(self)\n\n\tself._opts = opts\n\tself._body = []\n\tself._headers = {}\n\tif (opts.auth)\n\t\tself.setHeader('Authorization', 'Basic ' + new Buffer(opts.auth).toString('base64'))\n\tObject.keys(opts.headers).forEach(function (name) {\n\t\tself.setHeader(name, opts.headers[name])\n\t})\n\n\tvar preferBinary\n\tvar useFetch = true\n\tif (opts.mode === 'disable-fetch' || ('requestTimeout' in opts && !capability.abortController)) {\n\t\t// If the use of XHR should be preferred. Not typically needed.\n\t\tuseFetch = false\n\t\tpreferBinary = true\n\t} else if (opts.mode === 'prefer-streaming') {\n\t\t// If streaming is a high priority but binary compatibility and\n\t\t// the accuracy of the 'content-type' header aren't\n\t\tpreferBinary = false\n\t} else if (opts.mode === 'allow-wrong-content-type') {\n\t\t// If streaming is more important than preserving the 'content-type' header\n\t\tpreferBinary = !capability.overrideMimeType\n\t} else if (!opts.mode || opts.mode === 'default' || opts.mode === 'prefer-fast') {\n\t\t// Use binary if text streaming may corrupt data or the content-type header, or for speed\n\t\tpreferBinary = true\n\t} else {\n\t\tthrow new Error('Invalid value for opts.mode')\n\t}\n\tself._mode = decideMode(preferBinary, useFetch)\n\tself._fetchTimer = null\n\n\tself.on('finish', function () {\n\t\tself._onFinish()\n\t})\n}\n\ninherits(ClientRequest, stream.Writable)\n\nClientRequest.prototype.setHeader = function (name, value) {\n\tvar self = this\n\tvar lowerName = name.toLowerCase()\n\t// This check is not necessary, but it prevents warnings from browsers about setting unsafe\n\t// headers. To be honest I'm not entirely sure hiding these warnings is a good thing, but\n\t// http-browserify did it, so I will too.\n\tif (unsafeHeaders.indexOf(lowerName) !== -1)\n\t\treturn\n\n\tself._headers[lowerName] = {\n\t\tname: name,\n\t\tvalue: value\n\t}\n}\n\nClientRequest.prototype.getHeader = function (name) {\n\tvar header = this._headers[name.toLowerCase()]\n\tif (header)\n\t\treturn header.value\n\treturn null\n}\n\nClientRequest.prototype.removeHeader = function (name) {\n\tvar self = this\n\tdelete self._headers[name.toLowerCase()]\n}\n\nClientRequest.prototype._onFinish = function () {\n\tvar self = this\n\n\tif (self._destroyed)\n\t\treturn\n\tvar opts = self._opts\n\n\tvar headersObj = self._headers\n\tvar body = null\n\tif (opts.method !== 'GET' && opts.method !== 'HEAD') {\n\t\tif (capability.arraybuffer) {\n\t\t\tbody = toArrayBuffer(Buffer.concat(self._body))\n\t\t} else if (capability.blobConstructor) {\n\t\t\tbody = new global.Blob(self._body.map(function (buffer) {\n\t\t\t\treturn toArrayBuffer(buffer)\n\t\t\t}), {\n\t\t\t\ttype: (headersObj['content-type'] || {}).value || ''\n\t\t\t})\n\t\t} else {\n\t\t\t// get utf8 string\n\t\t\tbody = Buffer.concat(self._body).toString()\n\t\t}\n\t}\n\n\t// create flattened list of headers\n\tvar headersList = []\n\tObject.keys(headersObj).forEach(function (keyName) {\n\t\tvar name = headersObj[keyName].name\n\t\tvar value = headersObj[keyName].value\n\t\tif (Array.isArray(value)) {\n\t\t\tvalue.forEach(function (v) {\n\t\t\t\theadersList.push([name, v])\n\t\t\t})\n\t\t} else {\n\t\t\theadersList.push([name, value])\n\t\t}\n\t})\n\n\tif (self._mode === 'fetch') {\n\t\tvar signal = null\n\t\tvar fetchTimer = null\n\t\tif (capability.abortController) {\n\t\t\tvar controller = new AbortController()\n\t\t\tsignal = controller.signal\n\t\t\tself._fetchAbortController = controller\n\n\t\t\tif ('requestTimeout' in opts && opts.requestTimeout !== 0) {\n\t\t\t\tself._fetchTimer = global.setTimeout(function () {\n\t\t\t\t\tself.emit('requestTimeout')\n\t\t\t\t\tif (self._fetchAbortController)\n\t\t\t\t\t\tself._fetchAbortController.abort()\n\t\t\t\t}, opts.requestTimeout)\n\t\t\t}\n\t\t}\n\n\t\tglobal.fetch(self._opts.url, {\n\t\t\tmethod: self._opts.method,\n\t\t\theaders: headersList,\n\t\t\tbody: body || undefined,\n\t\t\tmode: 'cors',\n\t\t\tcredentials: opts.withCredentials ? 'include' : 'same-origin',\n\t\t\tsignal: signal\n\t\t}).then(function (response) {\n\t\t\tself._fetchResponse = response\n\t\t\tself._connect()\n\t\t}, function (reason) {\n\t\t\tglobal.clearTimeout(self._fetchTimer)\n\t\t\tif (!self._destroyed)\n\t\t\t\tself.emit('error', reason)\n\t\t})\n\t} else {\n\t\tvar xhr = self._xhr = new global.XMLHttpRequest()\n\t\ttry {\n\t\t\txhr.open(self._opts.method, self._opts.url, true)\n\t\t} catch (err) {\n\t\t\tprocess.nextTick(function () {\n\t\t\t\tself.emit('error', err)\n\t\t\t})\n\t\t\treturn\n\t\t}\n\n\t\t// Can't set responseType on really old browsers\n\t\tif ('responseType' in xhr)\n\t\t\txhr.responseType = self._mode.split(':')[0]\n\n\t\tif ('withCredentials' in xhr)\n\t\t\txhr.withCredentials = !!opts.withCredentials\n\n\t\tif (self._mode === 'text' && 'overrideMimeType' in xhr)\n\t\t\txhr.overrideMimeType('text/plain; charset=x-user-defined')\n\n\t\tif ('requestTimeout' in opts) {\n\t\t\txhr.timeout = opts.requestTimeout\n\t\t\txhr.ontimeout = function () {\n\t\t\t\tself.emit('requestTimeout')\n\t\t\t}\n\t\t}\n\n\t\theadersList.forEach(function (header) {\n\t\t\txhr.setRequestHeader(header[0], header[1])\n\t\t})\n\n\t\tself._response = null\n\t\txhr.onreadystatechange = function () {\n\t\t\tswitch (xhr.readyState) {\n\t\t\t\tcase rStates.LOADING:\n\t\t\t\tcase rStates.DONE:\n\t\t\t\t\tself._onXHRProgress()\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\t// Necessary for streaming in Firefox, since xhr.response is ONLY defined\n\t\t// in onprogress, not in onreadystatechange with xhr.readyState = 3\n\t\tif (self._mode === 'moz-chunked-arraybuffer') {\n\t\t\txhr.onprogress = function () {\n\t\t\t\tself._onXHRProgress()\n\t\t\t}\n\t\t}\n\n\t\txhr.onerror = function () {\n\t\t\tif (self._destroyed)\n\t\t\t\treturn\n\t\t\tself.emit('error', new Error('XHR error'))\n\t\t}\n\n\t\ttry {\n\t\t\txhr.send(body)\n\t\t} catch (err) {\n\t\t\tprocess.nextTick(function () {\n\t\t\t\tself.emit('error', err)\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t}\n}\n\n/**\n * Checks if xhr.status is readable and non-zero, indicating no error.\n * Even though the spec says it should be available in readyState 3,\n * accessing it throws an exception in IE8\n */\nfunction statusValid (xhr) {\n\ttry {\n\t\tvar status = xhr.status\n\t\treturn (status !== null && status !== 0)\n\t} catch (e) {\n\t\treturn false\n\t}\n}\n\nClientRequest.prototype._onXHRProgress = function () {\n\tvar self = this\n\n\tif (!statusValid(self._xhr) || self._destroyed)\n\t\treturn\n\n\tif (!self._response)\n\t\tself._connect()\n\n\tself._response._onXHRProgress()\n}\n\nClientRequest.prototype._connect = function () {\n\tvar self = this\n\n\tif (self._destroyed)\n\t\treturn\n\n\tself._response = new IncomingMessage(self._xhr, self._fetchResponse, self._mode, self._fetchTimer)\n\tself._response.on('error', function(err) {\n\t\tself.emit('error', err)\n\t})\n\n\tself.emit('response', self._response)\n}\n\nClientRequest.prototype._write = function (chunk, encoding, cb) {\n\tvar self = this\n\n\tself._body.push(chunk)\n\tcb()\n}\n\nClientRequest.prototype.abort = ClientRequest.prototype.destroy = function () {\n\tvar self = this\n\tself._destroyed = true\n\tglobal.clearTimeout(self._fetchTimer)\n\tif (self._response)\n\t\tself._response._destroyed = true\n\tif (self._xhr)\n\t\tself._xhr.abort()\n\telse if (self._fetchAbortController)\n\t\tself._fetchAbortController.abort()\n}\n\nClientRequest.prototype.end = function (data, encoding, cb) {\n\tvar self = this\n\tif (typeof data === 'function') {\n\t\tcb = data\n\t\tdata = undefined\n\t}\n\n\tstream.Writable.prototype.end.call(self, data, encoding, cb)\n}\n\nClientRequest.prototype.flushHeaders = function () {}\nClientRequest.prototype.setTimeout = function () {}\nClientRequest.prototype.setNoDelay = function () {}\nClientRequest.prototype.setSocketKeepAlive = function () {}\n\n// Taken from http://www.w3.org/TR/XMLHttpRequest/#the-setrequestheader%28%29-method\nvar unsafeHeaders = [\n\t'accept-charset',\n\t'accept-encoding',\n\t'access-control-request-headers',\n\t'access-control-request-method',\n\t'connection',\n\t'content-length',\n\t'cookie',\n\t'cookie2',\n\t'date',\n\t'dnt',\n\t'expect',\n\t'host',\n\t'keep-alive',\n\t'origin',\n\t'referer',\n\t'te',\n\t'trailer',\n\t'transfer-encoding',\n\t'upgrade',\n\t'via'\n]\n\n};"],
"names":["shadow$provide","global","require","module","exports","process","Buffer","capability","inherits","response","stream","toArrayBuffer","IncomingMessage","rStates","readyStates","ClientRequest","module.exports","opts","self","Writable","call","_opts","_body","_headers","auth","setHeader","toString","Object","keys","headers","forEach","name","useFetch","mode","abortController","preferBinary","overrideMimeType","Error","_mode","fetch","mozchunkedarraybuffer","msstream","arraybuffer","vbArray","_fetchTimer","on","_onFinish","prototype","ClientRequest.prototype.setHeader","value","lowerName","toLowerCase","unsafeHeaders","indexOf","getHeader","ClientRequest.prototype.getHeader","header","removeHeader","ClientRequest.prototype.removeHeader","ClientRequest.prototype._onFinish","_destroyed","headersObj","body","method","concat","blobConstructor","Blob","map","buffer","type","headersList","keyName","Array","isArray","v","push","signal","controller","AbortController","_fetchAbortController","requestTimeout","setTimeout","emit","abort","url","undefined","credentials","withCredentials","then","_fetchResponse","_connect","reason","clearTimeout","xhr","_xhr","XMLHttpRequest","open","err","nextTick","responseType","split","timeout","ontimeout","xhr.ontimeout","setRequestHeader","_response","onreadystatechange","xhr.onreadystatechange","readyState","LOADING","DONE","_onXHRProgress","onprogress","xhr.onprogress","onerror","xhr.onerror","send","ClientRequest.prototype._onXHRProgress","status","e","ClientRequest.prototype._connect","_write","ClientRequest.prototype._write","chunk","encoding","cb","destroy","ClientRequest.prototype.destroy","end","ClientRequest.prototype.end","data","flushHeaders","ClientRequest.prototype.flushHeaders","ClientRequest.prototype.setTimeout","setNoDelay","ClientRequest.prototype.setNoDelay","setSocketKeepAlive","ClientRequest.prototype.setSocketKeepAlive"]
}
