shadow$provide.module$node_modules$stream_http$lib$request=function(global,require,module,exports){var process=require("module$node_modules$process$browser"),Buffer=require("module$node_modules$buffer$index").Buffer,capability=require("module$node_modules$stream_http$lib$capability");exports=require("module$node_modules$inherits$inherits_browser");var response$jscomp$0=require("module$node_modules$stream_http$lib$response"),stream=require("module$node_modules$readable_stream$readable_browser"),toArrayBuffer=
require("module$node_modules$to_arraybuffer$index"),IncomingMessage=response$jscomp$0.IncomingMessage,rStates=response$jscomp$0.readyStates;require=module.exports=function(opts){var self=this;stream.Writable.call(self);self._opts=opts;self._body=[];self._headers={};opts.auth&&self.setHeader("Authorization","Basic "+(new Buffer(opts.auth)).toString("base64"));Object.keys(opts.headers).forEach(function(name){self.setHeader(name,opts.headers[name])});var useFetch=!0;if("disable-fetch"===opts.mode||"requestTimeout"in
opts&&!capability.abortController){useFetch=!1;var preferBinary=!0}else if("prefer-streaming"===opts.mode)preferBinary=!1;else if("allow-wrong-content-type"===opts.mode)preferBinary=!capability.overrideMimeType;else{if(opts.mode&&"default"!==opts.mode&&"prefer-fast"!==opts.mode)throw Error("Invalid value for opts.mode");preferBinary=!0}self._mode=capability.fetch&&useFetch?"fetch":capability.mozchunkedarraybuffer?"moz-chunked-arraybuffer":capability.msstream?"ms-stream":capability.arraybuffer&&preferBinary?
"arraybuffer":capability.vbArray&&preferBinary?"text:vbarray":"text";self._fetchTimer=null;self.on("finish",function(){self._onFinish()})};exports(require,stream.Writable);require.prototype.setHeader=function(name,value){var lowerName=name.toLowerCase();-1===unsafeHeaders.indexOf(lowerName)&&(this._headers[lowerName]={name,value})};require.prototype.getHeader=function(name){return(name=this._headers[name.toLowerCase()])?name.value:null};require.prototype.removeHeader=function(name){delete this._headers[name.toLowerCase()]};
require.prototype._onFinish=function(){var self=this;if(!self._destroyed){var opts=self._opts,headersObj=self._headers,body=null;"GET"!==opts.method&&"HEAD"!==opts.method&&(body=capability.arraybuffer?toArrayBuffer(Buffer.concat(self._body)):capability.blobConstructor?new global.Blob(self._body.map(function(buffer){return toArrayBuffer(buffer)}),{type:(headersObj["content-type"]||{}).value||""}):Buffer.concat(self._body).toString());var headersList=[];Object.keys(headersObj).forEach(function(keyName){var name=
headersObj[keyName].name;keyName=headersObj[keyName].value;Array.isArray(keyName)?keyName.forEach(function(v){headersList.push([name,v])}):headersList.push([name,keyName])});if("fetch"===self._mode){var signal=null;if(capability.abortController){var controller=new AbortController;signal=controller.signal;self._fetchAbortController=controller;"requestTimeout"in opts&&0!==opts.requestTimeout&&(self._fetchTimer=global.setTimeout(function(){self.emit("requestTimeout");self._fetchAbortController&&self._fetchAbortController.abort()},
opts.requestTimeout))}global.fetch(self._opts.url,{method:self._opts.method,headers:headersList,body:body||void 0,mode:"cors",credentials:opts.withCredentials?"include":"same-origin",signal}).then(function(response){self._fetchResponse=response;self._connect()},function(reason){global.clearTimeout(self._fetchTimer);self._destroyed||self.emit("error",reason)})}else{var xhr=self._xhr=new global.XMLHttpRequest;try{xhr.open(self._opts.method,self._opts.url,!0)}catch(err){process.nextTick(function(){self.emit("error",
err)});return}"responseType"in xhr&&(xhr.responseType=self._mode.split(":")[0]);"withCredentials"in xhr&&(xhr.withCredentials=!!opts.withCredentials);"text"===self._mode&&"overrideMimeType"in xhr&&xhr.overrideMimeType("text/plain; charset\x3dx-user-defined");"requestTimeout"in opts&&(xhr.timeout=opts.requestTimeout,xhr.ontimeout=function(){self.emit("requestTimeout")});headersList.forEach(function(header){xhr.setRequestHeader(header[0],header[1])});self._response=null;xhr.onreadystatechange=function(){switch(xhr.readyState){case rStates.LOADING:case rStates.DONE:self._onXHRProgress()}};
"moz-chunked-arraybuffer"===self._mode&&(xhr.onprogress=function(){self._onXHRProgress()});xhr.onerror=function(){self._destroyed||self.emit("error",Error("XHR error"))};try{xhr.send(body)}catch(err){process.nextTick(function(){self.emit("error",err)})}}}};require.prototype._onXHRProgress=function(){try{var status=this._xhr.status;var JSCompiler_inline_result=null!==status&&0!==status}catch(e){JSCompiler_inline_result=!1}JSCompiler_inline_result&&!this._destroyed&&(this._response||this._connect(),
this._response._onXHRProgress())};require.prototype._connect=function(){var self=this;self._destroyed||(self._response=new IncomingMessage(self._xhr,self._fetchResponse,self._mode,self._fetchTimer),self._response.on("error",function(err){self.emit("error",err)}),self.emit("response",self._response))};require.prototype._write=function(chunk,encoding,cb){this._body.push(chunk);cb()};require.prototype.abort=require.prototype.destroy=function(){this._destroyed=!0;global.clearTimeout(this._fetchTimer);
this._response&&(this._response._destroyed=!0);this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()};require.prototype.end=function(data,encoding,cb){"function"===typeof data&&(cb=data,data=void 0);stream.Writable.prototype.end.call(this,data,encoding,cb)};require.prototype.flushHeaders=function(){};require.prototype.setTimeout=function(){};require.prototype.setNoDelay=function(){};require.prototype.setSocketKeepAlive=function(){};var unsafeHeaders="accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 date dnt expect host keep-alive origin referer te trailer transfer-encoding upgrade via".split(" ")}
//# sourceMappingURL=module$node_modules$stream_http$lib$request.js.map
