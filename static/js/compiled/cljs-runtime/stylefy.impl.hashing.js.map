{"version":3,"sources":["stylefy/impl/hashing.cljc"],"mappings":";AAKA,AAAA,AAAKA;AACL,AAAKC,AAAyB,AAAA,AAACC;AAE/B;;;AAAA,AAAOC,AAEJC;AAFH,AAGE,AAAQ,AACE,AAAA,AAAMA,AACN,AAASA,AACT,AAAAE,AAAUF;AAHpB;AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAIQ,AAAA,AAA0E,AAACE,AAAOH;;;AAE1F,AAAM,AAAA,AAAMA;AAAqBJ;;AAAjC,AACM,AAASI;AAAqBA;;AADpC,AAEM,AAAAE,AAAUF;AAAqB,AAACI,AAAKJ;;AAF3C;;;;;AAIF,AAAA,AAAMK,AAAYC;AAAlB,AACE,AAAM,AAAK,AAACC,AAAOD;AAAnB,AACE,AAAME,AAAsB,AAACC,AAGC,AAAKC,AAAOC;AAAZ,AACE,AAAMC,AAAW,AAACD,AAAAA,AAAAA,AAASL,AAAAA;AAA3B,AACE,AAAI,AAACO,AAAuBD;AAC1B,AAACE,AAAMJ,AAAOC,AAAS,AAACI,AAAoBH;;AAC5CF;;AAPR,AASE,AAACM,AAAK,AAACC,AAA8BX;AAC7DY,AAAe,AAACC,AAAMb,AAAME;AAI5BU,AAAe,AAAA,AAAA,AAACE,AAAOF;AAGvBG,AAAa,AAAA,AAAAC,AAAKzB,AACH,AAACE,AAA0B,AAAA,AAA4BO,AACvDV;AAnBrB,AAoBE,AAAA,AAAKyB,AAAiB,AAACE,AAAKL;;AArBhC;;;AAuBF,AAAA,AAAMM,AAA0BC;AAAhC,AACE,AAACC,AAAO7B,AAAyB,AAAC8B,AAAQ,AAAA,AAA2BF","names":["stylefy.impl.hashing/default-class-prefix","stylefy.impl.hashing/use-custom-class-prefix?","cljs.core.atom","stylefy.impl.hashing/check-custom-class-prefix","custom-class-prefix","js/Error","cljs.core/Keyword","cljs.core.pr_str","cljs.core/name","stylefy.impl.hashing/hash-style","style","cljs.core/empty?","hashable-garden-units","cljs.core.reduce","result","prop-key","prop-value","stylefy.impl.utils/is-garden-value?","cljs.core.assoc","garden.compiler/render-css","cljs.core/keys","stylefy.impl.utils/remove-special-keywords","hashable-style","cljs.core.merge","cljs.core.dissoc","class-prefix","cljs.core/deref","cljs.core/hash","stylefy.impl.hashing/init-custom-class-prefix","options","cljs.core/reset!","cljs.core/boolean"],"sourcesContent":["(ns stylefy.impl.hashing\r\n  (:require [garden.core :refer [css]]\r\n            [stylefy.impl.utils :as utils]\r\n            [garden.compiler :as compiler]))\r\n\r\n(def default-class-prefix \"_stylefy\")\r\n(def use-custom-class-prefix? (atom false))\r\n\r\n(defn- check-custom-class-prefix\r\n  \"Checks that the value is valid and returns as properly formatted prefix.\"\r\n  [custom-class-prefix]\r\n  (assert (or\r\n            (nil? custom-class-prefix)\r\n            (string? custom-class-prefix)\r\n            (keyword? custom-class-prefix))\r\n          (str \"Custom class prefix should be either string, keyword or nil, got: \" (pr-str custom-class-prefix)))\r\n\r\n  (cond (nil? custom-class-prefix) default-class-prefix\r\n        (string? custom-class-prefix) custom-class-prefix\r\n        (keyword? custom-class-prefix) (name custom-class-prefix)))\r\n\r\n(defn hash-style [style]\r\n  (when (not (empty? style))\r\n    (let [hashable-garden-units (reduce\r\n                                  ; Convert Garden units to CSS to make them structurally\r\n                                  ; hashable (different contents = different hash)\r\n                                  (fn [result prop-key]\r\n                                    (let [prop-value (prop-key style)]\r\n                                      (if (utils/is-garden-value? prop-value)\r\n                                        (assoc result prop-key (compiler/render-css prop-value))\r\n                                        result)))\r\n                                  {}\r\n                                  (keys (utils/remove-special-keywords style)))\r\n          hashable-style (merge style hashable-garden-units)\r\n          ; Hash style without certain special keywords:\r\n          ; - sub-styles is only a link to other styles, it does not define the actual properties of this style\r\n          ; - class-prefix is only for class naming, the style looks the same with it or without\r\n          hashable-style (dissoc hashable-style\r\n                                 :stylefy.core/sub-styles\r\n                                 :stylefy.core/class-prefix)\r\n          class-prefix (if @use-custom-class-prefix?\r\n                         (check-custom-class-prefix (:stylefy.core/class-prefix style))\r\n                         default-class-prefix)]\r\n      (str class-prefix \"_\" (hash hashable-style)))))\r\n\r\n(defn init-custom-class-prefix [options]\r\n  (reset! use-custom-class-prefix? (boolean (:use-custom-class-prefix? options))))\r\n"]}